{% extends "base.html" %}
{% load staticfiles %}
{% load entities %}

{% block title %}{% if object.id %}Story {{ object.title }}{% else %}New Story{% endif %} - {% endblock title %}
{% block content %}
  {% if object.id %}{% include "./includes/story_header.html" %}{% endif %}

<div id='newstoryform'>
  {% if not form.title.value %}<h1>Create story</h1>{% endif %}

  <form method="POST" action="" novalidate id="storyform">
    {% csrf_token %}

    <p>{{ form.title.label_tag }} {{ form.title }}</p>
    {% if  form.title.errors  %}
        <ul class="errorlist"><li>{{ form.title.errors }}</li></ul>
    {% endif %}
    <p>{{ form.visibility.label_tag }} {{ form.visibility }} <span class="helptext">{{form.visibility.help_text | safe }}</span></p>


{{ formset.management_form }}
{{ formsetgraph.management_form }}

    <table class="formset manual-add" id="storyparts">
      <tbody>
        {% for form in formset %}
            <tr class="storypart description" style="visibility: hidden"><td>
                <textarea class="partval" cols="0" rows="0">{% if form.description.value %}{{form.description.value}}{% endif %}</textarea>
                <input class="partorder" type="hidden" value={%if form.ORDER.value %}{{form.ORDER.value}}{% else %}''{% endif %}>
                <input class="partdel" type="hidden" value="{%if form.DELETE.value %}true{% else %}false{% endif %}">
                <input class="parterr"  type="text" value="{% if form.description.errors %}form.description.errors{% endif %}">
            </td><td></td></tr>
        {% endfor %}
        {% for form in formsetgraph %}
            <tr class="storypart graph" style="visibility: hidden"><td>
                <input class="models_or_groupval" type="hidden" value="{% if form.models_or_group.value %}{{form.models_or_group.value}}{% endif %}">
                <input class="protocolval" type="hidden" value="{% if form.protocol.value %}{{form.protocol.value}}{% endif %}">
                <input class="graphfiles" type="hidden" value="{% if form.graphfiles.value %}{{form.graphfiles.value}}{% endif %}">
                <input class="partorder" type="hidden" value={%if form.ORDER.value %}{{form.ORDER.value}}{% else %}''{% endif %}>
                <input class="partdel" type="hidden" value="{%if form.DELETE.value %}true{% else %}false{% endif %}">
                <input class="parterr"  type="text" value="{% if form.description.errors %}form.description.errors{% endif %}">
            </td><td></td></tr>
        {% endfor %}
      </tbody>
        <tfoot style="border-top: 1px solid black;">
        <tr class="dynamic-form-add">
            <td class="django-formset-add td" colspan="2">
                <a id="add-description">add decription text</a>
                <a id="add-graph">add graph</a>
            </td>
        </tr>
        </tfoot>
    </table>

    <button id="savebutton">Save Story</button>
    </p>
  </form>
</div>

<script>
//// Fill dropdowns
//$.ajax({
//  url: "{% url 'stories:filter_modelorgroup' %}",
//  success: function (data) {
//    $("#id_graph-0-models_or_group").html(data);
//    $("#id_graph-0-models_or_group").change();
//  }
//})
//
//
//$('body').on('change', '#id_graph-0-models_or_group', function() {
//    var model = $(this).val();
//    var url = "{% url 'stories:filter_protocol' 'model'%}".replace("model", model) ;
//    $.ajax({                       // initialize an AJAX request
//      url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
//      success: function (data) {   // `data` is the return of the `load_cities` view function
//        $("#id_graph-0-protocol").html(data);  // replace the contents of the city input with the data that came from the server
//        $("#id_graph-0-protocol").change();
//      }
//    })
//});
//
//$('body').on('change', '#id_graph-0-protocol', function() {
//    var model = $('#id_graph-0-models_or_group').val();
//    var protocol = $(this).val();
//    var url = "{% url 'stories:filter_graph' 'model' '0'%}".replace("0", protocol).replace("model", model) ;
//    $.ajax({                       // initialize an AJAX request
//      url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
//      success: function (data) {   // `data` is the return of the `load_cities` view function
//        $("#id_graph-0-graphfiles").html(data);  // replace the contents of the city input with the data that came from the server
//      }
//    })
//
//});

</script>
{% endblock %}
