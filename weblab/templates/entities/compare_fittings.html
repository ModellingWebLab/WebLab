{% extends "entities/entity_version.html" %}
{% load entities %}
{% load fittings %}
{% load staticfiles %}

{% block title %}{{ type|capfirst }}: compare fitting experiments - {% endblock title %}

{% block content_detail %}
    <div id="entityexperimentlist">
      <h3>Fitting Experiments using this {{type}}</h3>
      <p>
      This {{type}} has been run with the following datasets.
      Click to view the latest results of each single fitting experiment, or select multiple fitting experiments to compare them.
      </p>

      <div id="entityexperimentlistpartners">
        <ul>
          {% for dataset, fittings in comparisons %}

            <li>
              {{ dataset }}
              {% if entity.entity_type == 'model' %}
                <ul>
                  {% for fitting in fittings %}
                    <li>
                      <input name='experimentVersionIds', value="{{ fitting.latest_version.id }}" type="checkbox">
                      <a href="{% url 'fitting:result:version' fitting.id fitting.latest_version.id %}">
                        {% if entity.entity_type == 'protocol' %}
                          {{ fitting|name_of_fittingspec }}
                        {% else %}
                          {{ fitting|name_of_protocol }}
                        {% endif %}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <ul>
                  {% for model, subgroup in fittings %}
                    {% with subgroup.0 as first_fitting %}
                    <li>
                      <!-- Show first item -->
                      <input name="experimentVersionIds", value="{{ first_fitting.latest_version.id }}" type="checkbox">
                      <a href="{% url "experiments:version" first_fitting.id first_fitting.latest_version.id %}">
                        {{ first_fitting|name_of_model }}
                      </a>

                      {% if subgroup|length > 1 %}
                        <ul style="display:none" class="all-versions">
                          <!-- Rest of items -->
                          {% for fitting in subgroup|slice:"1:" %}
                            <li>
                              <input name='experimentVersionIds', value="{{ fitting.latest_version.id }}" type="checkbox">
                              <a href="{% url 'fitting:result:version' fitting.id fitting.latest_version.id %}">
                                @{{ fitting.model_version.get_name }}
                                using
                                {% if entity.entity_type == 'protocol' %}
                                  {{ fitting|name_of_fittingspec }}
                                {% else %}
                                  {{ fitting|name_of_protocol }}
                                {% endif %}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      {% endif %}

                    </li>
                    {% endwith %}
                  {% endfor %}
                </ul>

              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>

      <div id="entityexperimentlistpartnersact">
        [<a id="entityexperimentlistpartnersactall">select all</a>]
        <span id="entityexperimentlist_span_latest">[<a id="entityexperimentlistpartnersactlatest">select latest</a>]</span>
        [<a id="entityexperimentlistpartnersactnone">select none</a>]
        <br/>
        <button id="entityexperimentlist_showallversions">show all versions</button>
        <button id="entityexperimentlistpartnersactcompare" data-base-href="{% url_fitting_comparison_base %}">compare selected fittings</button>
      </div>
    </div>
{% endblock content_detail %}
