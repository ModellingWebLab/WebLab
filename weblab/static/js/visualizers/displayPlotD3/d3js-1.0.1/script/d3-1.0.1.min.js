var _initializeD3,mercator_maxPhi,mercator_R;window.Modernizr=function(n,t,i){function h(n){s.cssText=n}function e(n,t){return typeof n===t}function c(n,t){return!!~(""+n).indexOf(t)}function d(n,t){var u,r;for(u in n)if(r=n[u],!c(r,"-")&&s[r]!==i)return t=="pfx"?r:!0;return!1}function ut(n,t,r){var f,u;for(f in n)if(u=t[n[f]],u!==i)return r===!1?n[f]:e(u,"function")?u.bind(r||t):u;return!1}function o(n,t,i){var r=n.charAt(0).toUpperCase()+n.slice(1),u=(n+" "+it.join(r+" ")+r).split(" ");return e(t,"string")||e(t,"undefined")?d(u,t):(u=(n+" "+rt.join(r+" ")+r).split(" "),ut(u,t,i))}var r={},y=!0,f=t.documentElement,l="modernizr",g=t.createElement(l),s=g.style,ft,ot={}.toString,nt=" -webkit- -moz- -o- -ms- ".split(" "),tt="Webkit Moz O ms",it=tt.split(" "),rt=tt.toLowerCase().split(" "),u={},p=[],w=p.slice,a,et=function(n,i,r,u){var c,a,h,v,e=t.createElement("div"),s=t.body,o=s||t.createElement("body");if(parseInt(r,10))while(r--)h=t.createElement("div"),h.id=u?u[r]:l+(r+1),e.appendChild(h);return c=["&#173;",'<style id="s',l,'">',n,"<\/style>"].join(""),e.id=l,(s?e:o).innerHTML+=c,o.appendChild(e),s||(o.style.background="",o.style.overflow="hidden",v=f.style.overflow,f.style.overflow="hidden",f.appendChild(o)),a=i(e,n),s?e.parentNode.removeChild(e):(o.parentNode.removeChild(o),f.style.overflow=v),!!a},b={}.hasOwnProperty,k,v;k=!e(b,"undefined")&&!e(b.call,"undefined")?function(n,t){return b.call(n,t)}:function(n,t){return t in n&&e(n.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,i,r;if(typeof t!="function")throw new TypeError;return i=w.call(arguments,1),r=function(){var f,e,u;return this instanceof r?(f=function(){},f.prototype=t.prototype,e=new f,u=t.apply(e,i.concat(w.call(arguments))),Object(u)===u?u:e):t.apply(n,i.concat(w.call(arguments)))},r}),u.canvas=function(){var n=t.createElement("canvas");return!!n.getContext&&!!n.getContext("2d")},u.postmessage=function(){return!!n.postMessage},u.rgba=function(){return h("background-color:rgba(150,255,150,.5)"),c(s.backgroundColor,"rgba")},u.hsla=function(){return h("background-color:hsla(120,40%,100%,.5)"),c(s.backgroundColor,"rgba")||c(s.backgroundColor,"hsla")},u.borderradius=function(){return o("borderRadius")},u.boxshadow=function(){return o("boxShadow")},u.cssanimations=function(){return o("animationName")},u.csstransforms=function(){return!!o("transform")},u.csstransitions=function(){return o("transition")},u.webworkers=function(){return!!n.Worker};for(v in u)k(u,v)&&(a=v.toLowerCase(),r[a]=u[v](),p.push((r[a]?"":"no-")+a));return r.addTest=function(n,t){if(typeof n=="object")for(var u in n)k(n,u)&&r.addTest(u,n[u]);else{if(n=n.toLowerCase(),r[n]!==i)return r;t=typeof t=="function"?t():t,typeof y!="undefined"&&y&&(f.className+=" "+(t?"":"no-")+n),r[n]=t}return r},h(""),g=ft=null,function(n,t){function v(n,t){var i=n.createElement("p"),r=n.getElementsByTagName("head")[0]||n.documentElement;return i.innerHTML="x<style>"+t+"<\/style>",r.insertBefore(i.lastChild,r.firstChild)}function s(){var n=r.elements;return typeof n=="string"?n.split(" "):n}function u(n){var t=a[n[l]];return t||(t={},o++,n[l]=o,a[o]=t),t}function h(n,r,f){if(r||(r=t),i)return r.createElement(n);f||(f=u(r));var e;return e=f.cache[n]?f.cache[n].cloneNode():b.test(n)?(f.cache[n]=f.createElem(n)).cloneNode():f.createElem(n),e.canHaveChildren&&!w.test(n)?f.frag.appendChild(e):e}function y(n,r){if(n||(n=t),i)return n.createDocumentFragment();r=r||u(n);for(var e=r.frag.cloneNode(),f=0,o=s(),h=o.length;f<h;f++)e.createElement(o[f]);return e}function p(n,t){t.cache||(t.cache={},t.createElem=n.createElement,t.createFrag=n.createDocumentFragment,t.frag=t.createFrag()),n.createElement=function(i){return r.shivMethods?h(i,n,t):t.createElem(i)},n.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+s().join().replace(/\w+/g,function(n){return t.createElem(n),t.frag.createElement(n),'c("'+n+'")'})+");return n}")(r,t.frag)}function c(n){n||(n=t);var f=u(n);return r.shivCSS&&!e&&!f.hasCSS&&(f.hasCSS=!!v(n,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),i||p(n,f),n}var f=n.html5||{},w=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,b=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,e,l="_html5shiv",o=0,a={},i,r;(function(){try{var n=t.createElement("a");n.innerHTML="<xyz><\/xyz>",e="hidden"in n,i=n.childNodes.length==1||function(){t.createElement("a");var n=t.createDocumentFragment();return typeof n.cloneNode=="undefined"||typeof n.createDocumentFragment=="undefined"||typeof n.createElement=="undefined"}()}catch(r){e=!0,i=!0}})(),r={elements:f.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:f.shivCSS!==!1,supportsUnknownElements:i,shivMethods:f.shivMethods!==!1,type:"default",shivDocument:c,createElement:h,createDocumentFragment:y},n.html5=r,c(t)}(this,t),r._version="2.6.2",r._prefixes=nt,r._domPrefixes=rt,r._cssomPrefixes=it,r.testProp=function(n){return d([n])},r.testAllProps=o,r.testStyles=et,f.className=f.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(y?" js "+p.join(" "):""),r}(this,this.document),function(n,t,i){function h(n){return"[object Function]"==y.call(n)}function c(n){return"string"==typeof n}function l(){}function w(n){return!n||"loaded"==n||"complete"==n||"uninitialized"==n}function e(){var n=a.shift();v=1,n?n.t?s(function(){("c"==n.t?u.injectCss:u.injectJs)(n.s,0,n.a,n.x,n.e,1)},0):(n(),e()):v=0}function ut(n,i,f,h,c,l,y){function k(t){if(!nt&&w(p.readyState)&&(tt.r=nt=1,!v&&e(),p.onload=p.onreadystatechange=null,t)){"img"!=n&&s(function(){g.removeChild(p)},50);for(var u in r[i])r[i].hasOwnProperty(u)&&r[i][u].onload()}}var y=y||u.errorTimeout,p=t.createElement(n),nt=0,b=0,tt={t:f,s:i,e:c,a:l,x:y};1===r[i]&&(b=1,r[i]=[]),"object"==n?p.data=i:(p.src=i,p.type=n),p.width=p.height="0",p.onerror=p.onload=p.onreadystatechange=function(){k.call(this,b)},a.splice(h,0,tt),"img"!=n&&(b||2===r[i]?(g.insertBefore(p,d?null:o),s(k,y)):r[i].push(p))}function ft(n,t,i,r,u){return v=0,t=t||"j",c(n)?ut("c"==t?et:nt,n,t,this.i++,i,r,u):(a.splice(this.i++,0,n),1==a.length&&e()),this}function b(){var n=u;return n.loader={load:ft,i:0},n}var f=t.documentElement,s=n.setTimeout,o=t.getElementsByTagName("script")[0],y={}.toString,a=[],v=0,k="MozAppearance"in f.style,d=k&&!!t.createRange().compareNode,g=d?f:o.parentNode,f=n.opera&&"[object Opera]"==y.call(n.opera),f=!!t.attachEvent&&!f,nt=k?"object":f?"script":"img",et=f?"script":nt,tt=Array.isArray||function(n){return"[object Array]"==y.call(n)},p=[],r={},it={timeout:function(n,t){return t.length&&(n.timeout=t[0]),n}},rt,u;u=function(n){function a(n){for(var n=n.split("!"),f=p.length,t=n.pop(),e=n.length,t={url:t,origUrl:t,prefixes:n},u,r,i=0;i<e;i++)r=n[i].split("="),(u=it[r.shift()])&&(t=u(t,r));for(i=0;i<f;i++)t=p[i](t);return t}function f(n,t,u,f,e){var o=a(n),s=o.autoCallback;o.url.split(".").pop().split("?").shift(),o.bypass||(t&&(t=h(t)?t:t[n]||t[f]||t[n.split("/").pop().split("?")[0]]),o.instead?o.instead(n,t,u,f,e):(r[o.url]?o.noexec=!0:r[o.url]=1,u.load(o.url,o.forceCSS||!o.forceJS&&"css"==o.url.split(".").pop().split("?").shift()?"c":i,o.noexec,o.attrs,o.timeout),(h(t)||h(s))&&u.load(function(){b(),t&&t(o.origUrl,e,f),s&&s(o.origUrl,e,f),r[o.url]=2})))}function s(n,t){function a(n,o){if(n){if(c(n))o||(i=function(){var n=[].slice.call(arguments);s.apply(this,n),u()}),f(n,i,t,0,e);else if(Object(n)===n)for(r in v=function(){var t=0,i;for(i in n)n.hasOwnProperty(i)&&t++;return t}(),n)n.hasOwnProperty(r)&&(!o&&!--v&&(h(i)?i=function(){var n=[].slice.call(arguments);s.apply(this,n),u()}:i[r]=function(n){return function(){var t=[].slice.call(arguments);n&&n.apply(this,t),u()}}(s[r])),f(n[r],i,t,r,e))}else o||u()}var e=!!n.test,o=n.load||n.both,i=n.callback||l,s=i,u=n.complete||l,v,r;a(e?n.yep:n.nope,!!o),o&&a(o)}var e,t,o=this.yepnope.loader;if(c(n))f(n,0,o,0);else if(tt(n))for(e=0;e<n.length;e++)t=n[e],c(t)?f(t,0,o,0):tt(t)?u(t):Object(t)===t&&s(t,o);else Object(n)===n&&s(n,o)},u.addPrefix=function(n,t){it[n]=t},u.addFilter=function(n){p.push(n)},u.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",rt=function(){t.removeEventListener("DOMContentLoaded",rt,0),t.readyState="complete"},0)),n.yepnope=b(),n.yepnope.executeStack=e,n.yepnope.injectJs=function(n,i,r,f,h,c){var a=t.createElement("script"),v,y,f=f||u.errorTimeout;a.src=n;for(y in r)a.setAttribute(y,r[y]);i=c?e:i||l,a.onreadystatechange=a.onload=function(){!v&&w(a.readyState)&&(v=1,i(),a.onload=a.onreadystatechange=null)},s(function(){v||(v=1,i(1))},f),h?a.onload():o.parentNode.insertBefore(a,o)},n.yepnope.injectCss=function(n,i,r,u,f,h){var u=t.createElement("link"),c,i=h?e:i||l;u.href=n,u.rel="stylesheet",u.type="text/css";for(c in r)u.setAttribute(c,r[c]);f||(o.parentNode.insertBefore(u,o),s(i,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},jQuery.fn.extend({mousewheel:function(n,t,i){return this.hover(function(){jQuery.event.mousewheel.giveFocus(this,n,t,i)},function(){jQuery.event.mousewheel.removeFocus(this)})},mousewheeldown:function(n,t){return this.mousewheel(function(){},n,t)},mousewheelup:function(n,t){return this.mousewheel(n,function(){},t)},unmousewheel:function(){return this.each(function(){var n=jQuery(this);n.unmouseover&&(n.unmouseover().unmouseout(),jQuery.event.mousewheel.removeFocus(this))})},unmousewheeldown:jQuery.fn.unmousewheel,unmousewheelup:jQuery.fn.unmousewheel}),jQuery.event.mousewheel={giveFocus:function(n,t,i,r){n._handleMousewheel&&jQuery(n).unmousewheel(),r==window.undefined&&i&&i.constructor!=Function&&(r=i,i=null),n._handleMousewheel=function(u){u||(u=window.event),r&&(u.preventDefault?u.preventDefault():u.returnValue=!1);var f=0;u.wheelDelta?(f=u.wheelDelta/120,window.opera&&(f=-f)):u.detail&&(f=-u.detail/3),t&&(f>0||!i)?t.apply(n,[u,f]):i&&f<0&&i.apply(n,[u,f])},window.addEventListener&&window.addEventListener("DOMMouseScroll",n._handleMousewheel,!1),window.onmousewheel=document.onmousewheel=n._handleMousewheel},removeFocus:function(n){n._handleMousewheel&&(window.removeEventListener&&window.removeEventListener("DOMMouseScroll",n._handleMousewheel,!1),window.onmousewheel=document.onmousewheel=null,n._handleMousewheel=null)}},D3={MinSizeToShow:1,Padding:20,maxTickArrangeIterations:5,tickLength:10,minLabelSpace:60,minTickSpace:5,minLogOrder:4,minNumOrder:5,TooltipDelay:1,TooltipDuration:10,CssPrefix:"",ZIndexNavigationLayer:1e3,ZIndexDOMMarkers:1500,ZIndexTooltipLayer:2e3,factory:{}},D3=D3||{},D3.Utils={intersect:function(n,t){if(!n||!t)return undefined;var i=Math.max(n.x,t.x),u=Math.min(n.x+n.width,t.x+t.width),r=Math.max(n.y,t.y),f=Math.min(n.y+n.height,t.y+t.height);return u>i&&f>r?{x:i,y:r,width:u-i,height:f-r}:undefined},includes:function(n,t){return!n||!t?!1:n.x<=t.x&&n.x+n.width>=t.x+t.width&&n.y<=t.y&&n.y+n.height>=t.y+t.height},equalRect:function(n,t){return!n||!t?!1:n.x==t.x&&n.width==t.width&&n.y==t.y&&n.height==t.height},calcCSWithPadding:function(n,t,i,r){var u={left:i.left,top:i.top,width:t.width-i.left-i.right,height:t.height-i.top-i.bottom};return new D3.CoordinateTransform(n,u,r)},requestAnimationFrame:function(n,t){setTimeout(n,1e3/60,t)},range:function(n,t){var r=t-n+1,u,i;if(r<=0)return[];for(u=new Array(r),i=0;i<r;i++)u[i]=i;return u},arrangeDiv:function(n,t){n.width(t.width),n.height(t.height)},unionRects:function(n,t){if(n===undefined)return t;if(t===undefined)return n;var i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),u=Math.max(n.x+n.width,t.x+t.width),f=Math.max(n.y+n.height,t.y+t.height);return{x:i,y:r,width:u-i,height:f-r}},readStyle:function(n,t){var f=n.attr("data-d3-style"),u,e,r,i,o,s;if(f){for(u=f.split(";"),e=u.length,r=0;r<e;r++)i=u[r].split(":",2),i&&i.length===2&&(o=i[0].trim(),s=i[1].trim(),t[o]=s);return t}return undefined},getDataSourceFunction:function(jqElem,defaultSource){var source=jqElem.attr("data-d3-datasource");return source?eval(source):defaultSource},getMinMax:function(n){var f,r,u,t,i;if(!n||n.length===0)return undefined;for(f=n.length,i=0;i<f;i++)if(t=n[i],!isNaN(t)){r=u=t;break}for(i++;i<f;i++)t=n[i],isNaN(t)||(t<r?r=t:t>u&&(u=t));return{min:r,max:u}},getMinMaxForPair:function(n,t){var h,f,e,o,s,r,u,i;if(!n||n.length===0)return undefined;if(!t||n.length!==t.length)throw"Arrays should be equal";for(h=n.length,i=0;i<h;i++)if(r=n[i],u=t[i],!isNaN(r)&&!isNaN(u)){f=e=r,o=s=u;break}for(i++;i<h;i++)(r=n[i],u=t[i],isNaN(r)||isNaN(u))||(r<f?f=r:r>e&&(e=r),u<o?o=u:u>s&&(s=u));return{minx:f,maxx:e,miny:o,maxy:s}},getBoundingBoxForArrays:function(n,t,i,r){var y=10,o,f,e,s,h,u,a,v;if(n&&t)if(n.length===1)f=n[0],i&&(f=i(f)),e=t[0],r&&(e=r(e)),s=Math.max(.1,Math.abs(f))/y,h=Math.max(.1,Math.abs(e))/y,o={x:f-s,y:e-h,width:2*s,height:2*h};else if(n.length>0&&(u=D3.Utils.getMinMaxForPair(n,t),u)){i&&(u.minx=i(u.minx),u.maxx=i(u.maxx)),r&&(u.miny=r(u.miny),u.maxy=r(u.maxy));var f=Math.min(u.minx,u.maxx),c=Math.abs(u.maxx-u.minx),e=Math.min(u.miny,u.maxy),l=Math.abs(u.maxy-u.miny);c===0&&(a=Math.max(.1,Math.abs(f)),f=f-a/200,c=a/100),l===0&&(v=Math.max(.1,Math.abs(e)),e=e-v/200,l=v/100),o={x:f,y:e,width:c,height:l}}return o}},D3=D3||{},D3.Binding=D3.Binding||{},function(){var u=[],f=[],n=[],t=[],i=function(n,t,i){for(var u,r=0,f=n.length;r<f;r++)if(u=n[r],(u.plot1===t||u.plot1===i)&&(u.plot2===t||u.plot2===i))return r;return-1},e=function(n,t){var o=[],f,i,e,r,u;for(t=t.slice(0),f=[n];f.length>0;)for(i=f.shift(),i!=n&&o.indexOf(i)<0&&o.push(i),e=t.length;--e>=0;)r=t[e],u=null,r.plot1===i?u=r.plot2:r.plot2===i&&(u=r.plot1),u&&(f.push(u),t.splice(e,1));return o},r=function(n,t){for(var r=[],f,o,i=0,u=n.length;i<u;i++)f=n[i],r.indexOf(f.plot1)<0&&r.push(f.plot1),r.indexOf(f.plot2)<0&&r.push(f.plot2);for(t.splice(0),i=0,u=r.length;i<u;i++)o=e(r[i],n),t.push({plot:r[i],reachable:o})};D3.Binding.bindPlots=function(e,o,s){var h,l;if(s==undefined||s=="vh"){var y=D3.Binding.bindPlots(e,o,"v"),p=D3.Binding.bindPlots(e,o,"h"),c=!1;return{destroy:function(){c||(y.destroy(),p.destroy(),c=!0)}}}if(s!="v"&&s!="h")throw"Parameter filter is incorrect";if(!e)throw"plot1 is incorrect";if(!o)throw"plot2 is incorrect";if(e=e.master,o=o.master,e===o)throw"plot1 equals plot2";if(h=s=="v"?f:u,l=i(h,e,o),l>=0)return h[l].binding;var a=s=="v"?t:n,c=!1,v={plot1:e,plot2:o,binding:{destroy:function(){if(!c){var n=i(h,e,o);n&&h.splice(n,1),r(h,a),c=!0}}}};return h.push(v),r(h,a),e.requestUpdateLayout(),v.binding},D3.Binding.getBoundPlots=function(i){for(var f={h:[],v:[]},r=0,u=n.length;r<u;r++)if(n[r].plot===i){f.h=n[r].reachable;break}for(r=0,u=t.length;r<u;r++)if(t[r].plot===i){f.v=t[r].reachable;break}return f}}(),D3.register=function(n,t){if(!n)throw"key is undefined";if(!t)throw"factory is undefined";D3.factory[n]=t},_initializeD3=function(){"use strict";var n=navigator.userAgent.toLowerCase(),t;n.indexOf("firefox")>=0?D3.CssPrefix="-moz":(n.indexOf("chrome")>=0||n.indexOf("safari")>=0)&&(D3.CssPrefix="-webkit"),navigator.userAgent.match(/(iPhone|iPod|iPad)/)&&document.addEventListener("touchmove",function(n){n.preventDefault()}),window.requestAnimationFrame?D3.Utils.requestAnimationFrame=function(n){return window.requestAnimationFrame(n)}:window.msRequestAnimationFrame?D3.Utils.requestAnimationFrame=function(n){return window.msRequestAnimationFrame(n)}:window.webkitRequestAnimationFrame?D3.Utils.requestAnimationFrame=function(n){return window.webkitRequestAnimationFrame(n)}:window.mozRequestAnimationFrame?D3.Utils.requestAnimationFrame=function(n){return window.mozRequestAnimationFrame(n)}:window.oRequestAnimationFrame&&(D3.Utils.requestAnimationFrame=function(n){return window.oRequestAnimationFrame(n)}),t=function(n,t){var i,r;if(typeof Modernizr!="undefined"&&n&&(Modernizr.canvas?Modernizr.borderradius?Modernizr.boxshadow?Modernizr.csstransforms?Modernizr.hsla?Modernizr.rgba||n.replaceWith('<div">Browser does not support rgba colors<\/div>'):n.replaceWith('<div">Browser does not support hsla colors<\/div>'):n.replaceWith('<div">Browser does not support 2d css transformations<\/div>'):n.replaceWith('<div">Browser does not support "box-shadow" style property<\/div>'):n.replaceWith('<div">Browser does not support "border-radius" style property<\/div>'):n.replaceWith('<div">Browser does not support HTML5 canvas<\/div>')),n.hasClass("d3-plot-master")||n.hasClass("d3-plot-dependant"))throw"The div element already is initialized as a plot";i=n.attr("data-d3-plot");switch(i){case"plot":return new D3.Plot(n,t);case"polyline":return new D3.Polyline(n,t);case"dom":return new D3.DOMPlot(n,t);case"figure":return new D3.Figure(n,t);case"chart":return new D3.Chart(n,t);case"grid":return new D3.GridlinesPlot(n,t);case"markers":return new D3.Markers(n,t);case"bingMaps":return new D3.BingMapsPlot(n,t)}if(r=D3.factory[i],r)return r(n,t);throw"Unknown plot type";},D3.asPlot=function(n){var i;if(!n)throw"Plot must be attached to div!";if(n.tagName!==undefined&&n.tagName.toLowerCase()==="div")i=$(n);else if(typeof n=="string"){if(i=$("#"+n),i.length===0)throw"There is no element with id "+n;n=i[0]}else if(n instanceof jQuery&&n.is("div"))i=n,n=n[0];else throw"Invalid input parameter! It should be div of id of div of jQuery of div";return n.plot!==undefined?n.plot:t(i)},D3.Event=D3.Event||{},D3.Event.appearanceChanged=jQuery.Event("appearanceChanged"),D3.Event.childrenChanged=jQuery.Event("childrenChanged"),D3.Event.isAutoFitChanged=jQuery.Event("isAutoFitEnabledChanged"),D3.Event.visibleRectChanged=jQuery.Event("visibleRectChanged"),D3.Plot=function(n,i,r){var b,et,v,y,f,p,ot,vt,bt,nt,s,tt,st,kt,w,it,dt;if(!n||!(n.hasClass("d3-plot-master")||n.hasClass("d3-plot-dependant"))){var e=i===undefined&&n!==undefined,u=i||this,h=n,l=r||h,yt,pt,a=e?new D3.CoordinateTransform:undefined,o=[],ht=!0,wt,k=!0,ct=!1,rt=!1,ut=!1,lt=!1,d,g,ft="",at=!1,c;if(n){ft=n.attr("data-d3-name")||n.attr("id")||"",n[0].plot=this;n.attr("unselectable","on").addClass("unselectable").on("selectstart",!1)}e&&(this._sharedCanvas=undefined),et=!1,this.requestsRender=!1,this.isInAnimation=!1,this.isAnimationFrameRequested=!1,v=!1,e&&(this.requestsUpdateLayout=!1),y=undefined,f=this,Object.defineProperty(this,"isMaster",{get:function(){return e},configurable:!1}),Object.defineProperty(this,"isRendered",{get:function(){return et},configurable:!1}),Object.defineProperty(this,"flatRendering",{get:function(){return e?lt:i.flatRendering},set:function(n){if(!e){i.flatRendering=n;return}lt!==n&&(lt=n,f.requestUpdateLayout())}}),Object.defineProperty(this,"master",{get:function(){return u},configurable:!1}),Object.defineProperty(this,"host",{get:function(){return h},configurable:!1}),Object.defineProperty(this,"centralPart",{get:function(){return l},configurable:!1}),Object.defineProperty(this,"name",{get:function(){return ft},set:function(n){ft!==n&&(ft=n,this.fireAppearanceChanged("name"))},configurable:!1}),Object.defineProperty(this,"children",{get:function(){return o.slice(0)},configurable:!1}),Object.defineProperty(this,"screenSize",{get:function(){return e?{width:d,height:g}:u.screenSize},configurable:!1}),Object.defineProperty(this,"xDataTransform",{get:function(){return yt},set:function(n){yt=n;this.onDataTransformChanged("x")},configurable:!1}),Object.defineProperty(this,"yDataTransform",{get:function(){return pt},set:function(n){pt=n;this.onDataTransformChanged("y")},configurable:!1}),Object.defineProperty(this,"coordinateTransform",{get:function(){return e?a.clone():u.coordinateTransform},configurable:!1}),Object.defineProperty(this,"aspectRatio",{get:function(){return e?wt:u.aspectRatio},set:function(n){e?(wt=n,this.updateLayout()):u.aspectRatio=n},configurable:!1}),Object.defineProperty(this,"isAutoFitEnabled",{get:function(){return e?k:u.isAutoFitEnabled},set:function(n){if(e){if(k===n)return;k=n,k?this.requestUpdateLayout():c=f.visibleRect,this.host.trigger(D3.Event.isAutoFitChanged)}else u.isAutoFitEnabled=n},configurable:!1}),Object.defineProperty(this,"isVisible",{get:function(){return ht},set:function(n){ht!==n&&(ht=n,this.onIsVisibleChanged())},configurable:!1}),Object.defineProperty(this,"visibleRect",{get:function(){return e?a.getPlotRect({x:0,y:0,width:d,height:g}):u.visibleRect},configurable:!1}),p=undefined,Object.defineProperty(this,"mapControl",{get:function(){return e?p:u.mapControl},configurable:!1}),this.selfMapRefresh=function(){if(e){if(this.map!==undefined){if(p!==undefined)throw"Plot composition can have only 1 map!";p=this.map,this.requestUpdateLayout()}if(this.constraint)if(y===undefined)y=this.constraint;else throw"Plot composition can have only 1 constraint function!";}else return},this.destroy=function(){this.host.removeClass("d3-plot")},this.remove=function(){this.master.removeChild(this),this.host.remove()},this.addChild=function(n){if(!n)throw"Child plot is undefined";if(n.master&&n.master!==n&&n.master!==this.master)throw"Given child plot already added to another plot";if(n.master!==this.master)n.onAddedTo(this.master);if(o.push(n),this.master._sharedCanvas&&(this.master._sharedCanvas.remove(),this.master._sharedCanvas=undefined),n.constraint)if(y===undefined)y=n.constraint;else throw"Plot composition can have only 1 constraint function!";if(n.map!==undefined){if(p!==undefined)throw"Plot composition can have only 1 map!";p=n.map}this.fireChildrenChanged({type:"add",plot:n});this.onChildrenChanged({type:"add",plot:n});this.requestUpdateLayout()},this.onChildrenChanged=function(){},this.onAddedTo=function(t){u=t,e=this===t;for(var i=o.length;--i>=0;)o[i].onAddedTo(t);e?n.addClass("d3-plot-master").removeClass("d3-plot-dependant"):n.removeClass("d3-plot-master").addClass("d3-plot-dependant")},this.removeChild=function(n){if(!n)throw"plot is undefined";for(var t,i=o.length;--i>=0;)if(t=o[i],t===n||t.name===n){o.splice(i,1);t.onAddedTo(t);this.master._sharedCanvas&&(this.master._sharedCanvas.remove(),this.master._sharedCanvas=undefined),t.constraint!==undefined&&(y=undefined),t.map!==undefined&&(p=undefined),this.fireChildrenChanged({type:"remove",plot:t});this.onChildrenChanged({type:"remove",plot:t});return this.requestUpdateLayout(),!0}for(i=o.length;--i>=0;)if(t=o[i],t.removeChild(n))return!0;return!1},this.getLocalBounds=function(){return b||(b=this.computeLocalBounds()),b},this.computeLocalBounds=function(){return undefined},this.invalidateLocalBounds=function(){var n=b;return b=undefined,n},this.aggregateBounds=function(){for(var n=f.getLocalBounds(),s=o.length,r,u,i,t=0;t<s;t++)r=o[t],u=r.aggregateBounds().bounds,n=D3.Utils.unionRects(n,u);return i=e&&n===undefined,i&&(n=p!==undefined?{x:-180,y:-90,width:360,height:180}:{x:0,y:0,width:1,height:1}),{bounds:n,isDefault:i}},this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}},this.aggregatePadding=function(){for(var n=f.getLocalPadding()||{left:0,right:0,top:0,bottom:0},u=o.length,r,t,i=0;i<u;i++)r=o[i],t=r.aggregatePadding(),n={left:Math.max(n.left,t.left),right:Math.max(n.right,t.right),top:Math.max(n.top,t.top),bottom:Math.max(n.bottom,t.bottom)};return n.left=n.left+D3.Padding||D3.Padding,n.right=n.right+D3.Padding||D3.Padding,n.top=n.top+D3.Padding||D3.Padding,n.bottom=n.bottom+D3.Padding||D3.Padding,n},ot=function(){if(u.flatRendering&&(v=!0,u._sharedCanvas&&(u._sharedCanvas._dirty=!0)),f.requestsUpdateLayout)f.requestsUpdateLayout=!1,f.isAnimationFrameRequested=!1,v=!0,f.updateLayout();else{f.isAnimationFrameRequested=!1;var n=f.screenSize,t=f.coordinateTransform.getPlotRect({x:0,y:0,width:n.width,height:n.height});vt(v,u,t,n)}v=!1,tt&&tt()},vt=function(n,t,i,r){var f,e,u,o;if(t&&t.isVisible)for((n||t.requestsRender)&&(t.requestsRender=!1,t.render(i,r)),f=t.children,e=f.length,u=0;u<e;u++)o=f[u],vt(n,o,i,r)},this.requestNextFrame=function(n){if(n=n||this,!e){u.requestNextFrame(n);return}(n.requestsRender=!0,this.isAnimationFrameRequested)||(this.isAnimationFrameRequested=!0,v=!1,D3.Utils.requestAnimationFrame(ot))},this.requestUpdateLayout=function(n){if(!e){u.requestUpdateLayout(n);return}(v=!0,at=n&&n.suppressNotifyBoundPlots,this.requestsUpdateLayout)||(this.requestsUpdateLayout=!0,this.isAnimationFrameRequested)||(this.isAnimationFrameRequested=!0,D3.Utils.requestAnimationFrame(ot))},this.onIsVisibleChanged=function(){this.updateLayout()},this.onDataTranformChangedCore=function(){},this.onDataTransformChanged=function(n){b=undefined;this.onDataTranformChangedCore(n);this.isAutoFitEnabled?this.master.requestUpdateLayout():this.master.fitToView()},this.render=function(n,t){var u=this.getLocalBounds(),i=!1,r;if(u){if(r=D3.Utils.intersect(u,n),r){var f=this.coordinateTransform,e=f.plotToScreenWidth(r.width),o=f.plotToScreenHeight(r.height);e>=D3.MinSizeToShow&&o>=D3.MinSizeToShow&&(this.renderCore(n,t),i=!0)}}else this.renderCore(n,t),i=!0;i!==et&&(et=i,this.onIsRenderedChanged())},this.renderCore=function(){},this.onIsRenderedChanged=function(){},this.fit=function(n,t){var r,i,f;if(d=n.width,g=n.height,r=undefined,k||ct)i=u.aggregateBounds(),c=i.bounds,f=i.isDefault?{left:0,top:0,bottom:0,right:0}:u.aggregatePadding(),a=D3.Utils.calcCSWithPadding(c,n,f,u.aspectRatio),r=a.getPlotRect({x:0,y:0,width:n.width,height:n.height}),y!==undefined&&t===!0&&(r=y(r,n),a=new D3.CoordinateTransform(r,{left:0,top:0,width:d,height:g},u.aspectRatio));else{var e=undefined,o=undefined,s=undefined,i=undefined;(rt===!0||ut===!0)&&(i=u.aggregateBounds(),s=i.isDefault?{left:0,top:0,bottom:0,right:0}:u.aggregatePadding()),rt===!0&&(c.width=i.bounds.width,c.x=i.bounds.x,e=i.isDefault?{left:0,top:0,bottom:0,right:0}:s),ut===!0&&(c.height=i.bounds.height,c.y=i.bounds.y,o=i.isDefault?{left:0,top:0,bottom:0,right:0}:s),f=undefined,(e!==undefined||o!==undefined)&&(f={left:e!==undefined?e.left:0,top:o!==undefined?o.top:0,bottom:o!==undefined?o.bottom:0,right:e!==undefined?e.right:0}),a=f!==undefined?D3.Utils.calcCSWithPadding(c,n,f,u.aspectRatio):new D3.CoordinateTransform(c,{left:0,top:0,width:d,height:g},u.aspectRatio),r=a.getPlotRect({x:0,y:0,width:n.width,height:n.height}),c=r}return r},this.updateLayout=function(){var c,l,a,o,s,y,t,n,i;if(this.requestsUpdateLayout=!1,e){if(c=f.visibleRect,l={width:h.width(),height:h.height()},l.width<=1||l.height<=1)return;if(a=this.measure(l),ct=!1,rt=!1,ut=!1,f.arrange(a),o=f.visibleRect,(o.x!==c.x||o.y!==c.y||o.width!==c.width||o.height!==c.height)&&f.fireVisibleRectChanged({visibleRect:o}),v=!0,ot(),!at){var r=D3.Binding.getBoundPlots(this),p=r.h.length,w=r.v.length;if(p>0||w>0){for(s=f.coordinateTransform.getPlotRect({x:0,y:0,width:a.width,height:a.height}),r.v=r.v.slice(0),t=0;t<p;t++)n=r.h[t],y=r.v.indexOf(n),y>=0?(r.v[y]=null,n.navigation.setVisibleRect(s,!1,{suppressNotifyBoundPlots:!0})):(i=n.visibleRect,i.x=s.x,i.width=s.width,n.navigation.setVisibleRect(i,!1,{suppressNotifyBoundPlots:!0}));for(t=0;t<w;t++)(n=r.v[t],n!=null)&&(i=n.visibleRect,i.y=s.y,i.height=s.height,n.navigation.setVisibleRect(i,!1,{suppressNotifyBoundPlots:!0}))}}at=!1}else u.updateLayout()},this.measure=function(n){return this.mapControl!==undefined&&this.mapControl.setOptions({width:n.width,height:n.height}),this.fit(n,!0),h&&h.children("div").each(function(){var n=$(this);n.css("top",0),n.css("left",0)}),n},this.arrange=function(n){var i,r,t,u;for(this.isMaster||D3.Utils.arrangeDiv(this.host,n),i=this.children,r=i.length,t=0;t<r;t++)u=i[t],u.arrange(n)},bt=function(n,t){f.isAutoFitEnabled&&(f.isAutoFitEnabled=!1),c=n,t!==undefined&&t.syncUpdate!==undefined&&t.syncUpdate===!0?f.updateLayout():f.requestUpdateLayout(t)},this.fitToView=function(){e?(this.isAutoFitEnabled=!1,this.navigation.stop(),ct=!0,this.requestUpdateLayout()):u.fitToView()},this.fitToViewX=function(){e?(this.isAutoFitEnabled=!1,this.navigation.stop(),rt=!0,this.requestUpdateLayout()):u.fitToViewX()},this.fitToViewY=function(){e?(this.isAutoFitEnabled=!1,this.navigation.stop(),ut=!0,this.requestUpdateLayout()):u.fitToViewY()},this.requestNextFrameOrUpdate=function(){this.isAutoFitEnabled?this.master.requestUpdateLayout():this.master.requestNextFrame(this)},this.getTooltip=function(){return undefined},e?(st=function(n,t){for(var r=n.children,f=r.length,u,i=0;i<f;i++)u=r[i],st(u,t);t(n)},this.enumAll=function(n,t){st(n,t)},kt=function(n,t){var u,i,o,r,e;if(nt=undefined,w(),u=function(){var n=[],i,r,u=t.x,e=t.y;return st(f,function(t){var f=t.xDataTransform?t.xDataTransform.plotToData(u):u,o=t.yDataTransform?t.yDataTransform.plotToData(e):e,s=t.getTooltip(f,o,u,e);s&&((f!==i||o!==r)&&(i=f,r=o,n.push("<div class='d3-tooltip-coordinates'>"+i+", "+r+"<\/div>")),n.push(s))}),n},i=u(),i.length!==0){for(s=$("<div><\/div>").addClass("d3-tooltip").hide().appendTo(f.host).css("position","absolute").css("left",n.x+15).css("top",n.y+15).css("z-index",D3.ZIndexTooltipLayer),o=i.length,r=0;r<o;r++)$(i[r]).appendTo(s).addClass("d3-tooltip-item");tt=function(){var n,i,t;if(s){if(s.empty(),n=u(),n.length===0)return 0;for(i=n.length,t=0;t<i;t++)$(n[t]).appendTo(s).addClass("d3-tooltip-item");return i}},e=s,s.fadeIn("fast",function(){e.fadeOutTimer=setTimeout(function(){tt=undefined,e.fadeOut("fast")},D3.TooltipDuration*1e3)})}},w=function(){nt&&(clearTimeout(nt),nt=undefined),tt=undefined,s&&(s.fadeOutTimer&&(clearTimeout(s.fadeOutTimer),s.fadeOutTimer=undefined),s.fadeOut("fast",function(){$(this).remove()}),s=undefined)},l.mousemove(function(n){var i;it=undefined;var e=D3.Gestures.getXBrowserMouseOrigin(h,n),t=D3.Gestures.getXBrowserMouseOrigin(l,n),r=f.coordinateTransform,u={x:r.screenToPlotX(t.x),y:r.screenToPlotY(t.y)};w(),nt=setTimeout(function(){kt(e,u)},D3.TooltipDelay*1e3),i=function(n,t,r){var f,e,u;if(n.onMouseMove)n.onMouseMove(t,r);for(f=n.children,e=f.length,u=0;u<e;u++)i(f[u],t,r)},i(f,t,u)}),l.mousedown(function(n){w(),it=D3.Gestures.getXBrowserMouseOrigin(l,n)}),l.mouseup(function(n){var t;if(w(),t=D3.Gestures.getXBrowserMouseOrigin(l,n),it&&it.x==t.x&&it.y==t.y){var i=f.coordinateTransform,u={x:i.screenToPlotX(t.x),y:i.screenToPlotY(t.y)},r=function(n,t,i){var f,e,u;if(n.onClick)n.onClick(t,i);for(f=n.children,e=f.length,u=0;u<e;u++)r(f[u],t,i)};r(f,t,u)}}),l.mouseleave(function(){w()})):this.enumAll=u.enumAll,this.get=function(n){var t=function(n,i){var u,e,r,f;if(i.name===n||i.host[0].id===n||i.host[0]===n)return i;for(u=i.children,e=u.length,r=0;r<e;r++)if(f=t(n,u[r]),f)return f;return undefined};return t(n,this.master)},this.fireAppearanceChanged=function(n){this.host.trigger(D3.Event.appearanceChanged,n)},this.fireChildrenChanged=function(n){this.master.host.trigger(D3.Event.childrenChanged,n)},this.fireVisibleRectChanged=function(n){w(),this.master.host.trigger(D3.Event.visibleRectChanged,n)},this.polyline=function(n,t){var i=this.get(n),r;return i||(r=$("<div><\/div>").attr("data-d3-name",n).attr("data-d3-plot","polyline").appendTo(this.host),i=new D3.Polyline(r,this.master),this.addChild(i)),i.draw(t),i},this.markers=function(n,t){var i=this.get(n),r;return i||(r=$("<div><\/div>").attr("data-d3-name",n).appendTo(this.host),i=new D3.Markers(r),this.addChild(i)),i.draw(t),i},this.heatmap=function(n,t){var i=this.get(n),r;return i||(r=$("<div><\/div>").attr("data-d3-name",n).attr("data-d3-plot","heatmap").appendTo(this.host),i=new D3.Heatmap(r,this.master),this.addChild(i)),i.draw(t),i},e&&(dt=new D3.Navigation(this,bt)),Object.defineProperty(this,"navigation",{get:function(){return e?dt:u.navigation},configurable:!1}),h&&h.children("div").each(function(){var n=$(this);n.hasClass("d3-plot-master")||n.hasClass("d3-plot-dependant")||n.attr("data-d3-plot")===undefined||n.attr("data-d3-plot")==="figure"||n.attr("data-d3-plot")==="chart"||f.addChild(t(n,u))}),this.getLegend=function(){return undefined},setTimeout(function(){if(h&&h.attr("data-d3-legend")){var n=$("#"+h.attr("data-d3-legend")),t=new D3.Legend(f,n);Object.defineProperty(f,"legend",{get:function(){return t},configurable:!1})}},0),n&&(e?(n.attr("data-d3-plot")!=="figure"&&n.attr("data-d3-plot")!=="chart"&&this.updateLayout(),n.addClass("d3-plot-master")):n.addClass("d3-plot-dependant"))}},D3.Legend=function(n,t){var i=[],r=t[0].style,u,e,f;D3.Gestures.FullEventList.forEach(function(n){t[0].addEventListener(n,function(n){n.stopPropagation()},!1)}),u=!0,Object.defineProperty(this,"isVisible",{get:function(){return u},set:function(n){u=n,r.display=u?"block":"none"},configurable:!1}),r.display="none",t.addClass("d3-legend"),t.addClass("unselectable"),e=function(){f(n),t[0].hasChildNodes()&&u&&(r.display="block")},f=function(u){var o=u.getLegend(),s;u.host.bind("childrenChanged",function(o,s){var l,h,c;if(s.type==="add"&&t[0].hasChildNodes()&&s.plot.master==n.master)f(s.plot);else if(s.type==="remove"){for(l=function(n){var u=i[n],f;i.splice(n,1),u.plot.host.unbind("childrenChanged"),u.onLegendRemove&&u.onLegendRemove(),t[0].removeChild(u.div[0]),f=u.plot.children,f.forEach(function(n){for(var t=0,r=i.length;t<r;t++)i[t].plot===n&&l(i[t])}),i.length===0&&(r.display="none")},h=0,c=i.length;h<c;h++)if(i[h].plot===s.plot){l(h);break}}else{for(t[0].innerHTML="",r.display="none",c=i.length,h=0;h<c;h++)i[h].onLegendRemove&&i[h].onLegendRemove();i=[],u.host.unbind("childrenChanged"),e()}}),o&&(o.div.appendTo(t),o.plot=u,i[i.length]=o),s=u.children,s.forEach(function(n){f(n)})},this.remove=function(){for(var u,r=0,f=i.length;r<f;r++)i[r].onLegendRemove&&i[r].onLegendRemove();i=[],u=function(n){n.host.unbind("childrenChanged");var t=n.children;t.forEach(function(n){u(n)})},u(n),t[0].innerHTML="",t.removeClass("d3-legend"),t.removeClass("unselectable")},e(),t.dblclick(function(n){n.stopImmediatePropagation()})},D3.CoordinateTransform=function(n,t,i){var f=0,e=0,r=1,u=1;n!==undefined&&t!==undefined&&(r=t.width/n.width,u=t.height/n.height,i!==undefined&&i>0&&(i*u<r?r=i*u:u=r/i),f=t.left-r*n.x,e=t.height+t.top+u*n.y),this.plotToScreenX=function(n){return n*r+f},this.plotToScreenY=function(n){return e-n*u},this.screenToPlotX=function(n){return(n-f)/r},this.screenToPlotY=function(n){return(e-n)/u},this.plotToScreenWidth=function(n){return n*r},this.plotToScreenHeight=function(n){return n*u},this.screenToPlotWidth=function(n){return n/r},this.screenToPlotHeight=function(n){return n/u},this.getPlotRect=function(n){var t=this.screenToPlotX(n.x),i=this.screenToPlotY(n.height+n.y);return{x:t,y:i,width:this.screenToPlotX(n.x+n.width)-t,height:this.screenToPlotY(n.y)-i}},this.getScale=function(){return{x:r,y:u}},this.getOffset=function(){return{x:f,y:e}},this.clone=function(){var n=new D3.CoordinateTransform;return n.plotToScreenX=this.plotToScreenX,n.plotToScreenY=this.plotToScreenY,n.screenToPlotX=this.screenToPlotX,n.screenToPlotY=this.screenToPlotY,n.plotToScreenWidth=this.plotToScreenWidth,n.plotToScreenHeight=this.plotToScreenHeight,n.screenToPlotWidth=this.screenToPlotWidth,n.screenToPlotHeight=this.screenToPlotHeight,n.getPlotRect=this.getPlotRect,n.getScale=this.getScale,n.getOffset=this.getOffset,n}},D3.CanvasPlot=function(n,t){if(this.base=D3.Plot,this.base(n,t),n){var i,r=function(){t._sharedCanvas&&(t._sharedCanvas.remove(),t._sharedCanvas=undefined)};this.getContext=function(n){var r,t=this.master,u,f;return t.flatRendering?(r=t._sharedCanvas,n=t._sharedCanvas._dirty&&n,t._sharedCanvas._dirty=!1):r=i,u=r[0].getContext("2d"),n&&(f=this.screenSize,u.clearRect(0,0,f.width,f.height)),u},this.destroy=function(){return D3.CanvasPlot.prototype.destroy.call(this),this.host.children(".d3-plot-canvas").remove(),r(),this},this.arrange=function(n){var u,t,f;D3.CanvasPlot.prototype.arrange.call(this,n),t=this.master,t.flatRendering?(t._sharedCanvas?u=t._sharedCanvas:(i?(u=i,i=undefined):u=$("<canvas><\/canvas>").prependTo(this.host).addClass("d3-plot-canvas"),t._sharedCanvas=u,t._sharedCanvas._dirty=!1),i&&(i.remove(),i=undefined)):(t._sharedCanvas&&r(),i||(i=$("<canvas><\/canvas>").prependTo(this.host).addClass("d3-plot-canvas")),u=i),f=u[0],f.width=n.width,f.height=n.height},this.getTransform=function(){var n=this.coordinateTransform,t=n.plotToScreenX,i=n.plotToScreenY,r=this.xDataTransform&&this.xDataTransform.dataToPlot,u=this.yDataTransform&&this.yDataTransform.dataToPlot,f=r?function(n){return t(r(n))}:t,e=u?function(n){return i(u(n))}:i;return{dataToScreenX:f,dataToScreenY:e}},this.getScreenToDataTransform=function(){var n=this.coordinateTransform,t=n.screenToPlotX,i=n.screenToPlotY,r=this.xDataTransform&&this.xDataTransform.plotToData,u=this.yDataTransform&&this.yDataTransform.plotToData,f=r?function(n){return r(t(n))}:t,e=u?function(n){return u(i(n))}:i;return{screenToDataX:f,screenToDataY:e}}}},D3.CanvasPlot.prototype=new D3.Plot,D3.Polyline=function(n,t){var c=D3.Utils.getDataSourceFunction(n,D3.readCsv),r=c(n),h;this.base=D3.CanvasPlot,this.base(n,t);var f,e,i=1,u="#4169ed",o="butt",s="miter";r&&(i=typeof r.thickness!="undefined"?r.thickness:i,u=typeof r.stroke!="undefined"?r.stroke:u,o=typeof r.lineCap!="undefined"?r.lineCap:o,s=typeof r.lineJoin!="undefined"?r.lineJoin:s),this.draw=function(n){var t=n.y,r;if(!t)throw"Data series y is undefined";if(r=t.length,n.x||(n.x=D3.Utils.range(0,r-1)),r!=n.x.length)throw"Data series x and y have different lengths";f=t,e=n.x,i=typeof n.thickness!="undefined"?n.thickness:i,typeof i!="number"&&(i=parseFloat(i)||1),u=typeof n.stroke!="undefined"?n.stroke:u,o=typeof n.lineCap!="undefined"?n.lineCap:o,s=typeof n.lineJoin!="undefined"?n.lineJoin:s,this.invalidateLocalBounds(),this.requestNextFrameOrUpdate(),this.fireAppearanceChanged()},this.computeLocalBounds=function(){var n=this.xDataTransform&&this.xDataTransform.dataToPlot,t=this.yDataTransform&&this.yDataTransform.dataToPlot;return D3.Utils.getBoundingBoxForArrays(e,f,n,t)},this.getLocalPadding=function(){var n=i/2;return{left:n,right:n,top:n,bottom:n}},this.getTooltip=function(n,t,i,r){var o;if(e!==undefined&&f!=undefined&&(o=f.length,o!=0)){var s=this.coordinateTransform,h=s.plotToScreenX(i),c=s.plotToScreenY(r),l=this.getContext(!1),u=l.getImageData(h,c,1,1);return u.data[0]===0&&u.data[1]===0&&u.data[2]===0&&u.data[3]===0?undefined:"<div>"+(this.name||"Polyline")+"<\/div>"}},this.renderCore=function(n,t){var ut,c,v,l,y,a,ft,d,tt,ht,ct,g,nt,lt,at,it,rt;if((D3.Polyline.prototype.renderCore.call(this,n,t),e!==undefined&&f!=undefined)&&(ut=f.length,ut!=0)){var et=this.getTransform(),ot=et.dataToScreenX,st=et.dataToScreenY,vt=t.width,yt=t.height,p=0,w=vt,b=0,k=yt,r=this.getContext(!0);for(r.strokeStyle=u,r.fillStyle=u,r.lineWidth=i,r.lineCap=o,r.lineJoin=s,r.beginPath(),a=0,ft=function(){for(;a<ut;a++)if(!isNaN(e[a])&&!isNaN(f[a])){c=ot(e[a]),l=st(f[a]),d=h(c,l,p,w,b,k);break}d==0&&r.moveTo(c,l)},ft(),it=1,a++;a<ut;a++){if(isNaN(e[a])||isNaN(f[a])){it==1?(r.stroke(),rt=h(c,l,p,w,b,k),rt==0&&(r.beginPath(),r.arc(c,l,i/2,0,2*Math.PI),r.fill())):r.stroke(),r.beginPath(),a++,ft(),it=1;continue}if(lt=v=ot(e[a]),at=y=st(f[a]),!(Math.abs(c-v)<1)||!(Math.abs(l-y)<1)){for(ht=d,ct=tt=h(v,y,p,w,b,k);d|tt;){if(d&tt)break;g=v-c,nt=y-l,d?(c<p?(l+=nt*(p-c)/g,c=p):c>w?(l+=nt*(w-c)/g,c=w):l<b?(c+=g*(b-l)/nt,l=b):l>k&&(c+=g*(k-l)/nt,l=k),d=h(c,l,p,w,b,k)):(v<p?(y+=nt*(p-v)/g,v=p):v>w?(y+=nt*(w-v)/g,v=w):y<b?(v+=g*(b-y)/nt,y=b):y>k&&(v+=g*(k-y)/nt,y=k),tt=h(v,y,p,w,b,k))}d&tt||(ht!=0&&r.moveTo(c,l),r.lineTo(v,y),it++),c=lt,l=at,d=ct}}it==1?(r.stroke(),rt=h(c,l,p,w,b,k),rt==0&&(r.beginPath(),r.arc(c,l,i/2,0,2*Math.PI),r.fill())):r.stroke()}},h=function(n,t,i,r,u,f){return(n<i)<<3|(n>r)<<2|(t<u)<<1|t>f},this.onDataTransformChanged=function(n){this.invalidateLocalBounds(),D3.Polyline.prototype.onDataTransformChanged.call(this,n)},Object.defineProperty(this,"thickness",{get:function(){return i},set:function(n){if(n!=i){if(n<=0)throw"Polyline thickness must be positive";i=n,this.fireAppearanceChanged("thickness"),this.requestNextFrameOrUpdate()}},configurable:!1}),Object.defineProperty(this,"stroke",{get:function(){return u},set:function(n){n!=u&&(u=n,this.fireAppearanceChanged("stroke"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"lineCap",{get:function(){return o},set:function(n){n!=o&&(o=n,this.fireAppearanceChanged("lineCap"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"lineJoin",{get:function(){return s},set:function(n){n!=s&&(s=n,this.fireAppearanceChanged("lineJoin"),this.requestNextFrameOrUpdate())},configurable:!1}),this.getLegend=function(){var t=$("<div class='d3-legend-item'><\/div>"),r=$("<canvas style='margin-right: 15px'><\/canvas>").appendTo(t),n,o,f,e;return r[0].width=20,r[0].height=20,n=r.get(0).getContext("2d"),n.strokeStyle=u,n.lineWidth=i,n.moveTo(0,0),n.lineTo(20,20),n.stroke(),o=$("<span>"+this.name+"<\/span>").appendTo(t),this.host.bind("appearanceChanged",function(){n.clearRect(0,0,r[0].width,r[0].height),n.strokeStyle=u,n.lineWidth=i,n.moveTo(0,0),n.lineTo(20,20),n.stroke()}),f=this,e=function(){f.host.unbind("appearanceChanged"),t[0].innerHTML="",t.removeClass("d3-legend-item")},{div:t,onLegendRemove:e}},r&&typeof r.y!="undefined"&&this.draw(r)},D3.Polyline.prototype=new D3.CanvasPlot,D3.DOMPlot=function(n,t){var i,r,u,f;this.base=D3.Plot,this.base(n,t),i=[],r=function(n,t,r,u,f,e,o,s){if(n[0].tagName.toLowerCase()!=="div")throw"DOMPlot supports only DIV elements";n._x=r,n._y=u,n._width=f&&f>0?f:1,n._height=e&&e>0?e:1,n._originX=o||0,n._originY=s||0,n._scale=t||"element",n.addClass("d3-dom-marker"),n.css("display","none").css("z-index",D3.ZIndexDOMMarkers),i.push(n)},n.children("div[data-d3-position]").each(function(){var n=$(this),u=n.attr("data-d3-position").split(/\s+/g),t,h,c,f,i,l;if(u.length<2)throw"Position of the DOM marker should define x and y";var a=parseFloat(u[0]),v=parseFloat(u[1]),e,o,s=n.attr("data-d3-size");s&&(t=s.split(/\s+/g),t.length>=2&&(e=parseFloat(t[0]),o=parseFloat(t[1]))),f=n.attr("data-d3-origin"),f&&(i=f.split(/\s+/g),i.length>=2&&(h=parseFloat(i[0]),c=parseFloat(i[1]))),l=n.attr("data-d3-scale"),r(n,l,a,v,e,o,h,c)}),u=function(n){var t=n._x-n._originX*n._width,i=n._y+n._originY*n._height;return{left:t,top:i}},this.computeLocalBounds=function(){var v,a,o,s,h,r,f,e,n,t,c,l;if(i&&(a=i.length,a>0)){for(o=[],s=[],h=0,r=0;h<a;h++,r++)f=i[h],f._scale!="none"&&(e=u(f),o[r]=e.left,s[r]=e.top,o[++r]=e.left+f._width,s[r]=e.top-f._height);n=D3.Utils.getMinMax(o),t=D3.Utils.getMinMax(s),n&&t&&(c=this.xDataTransform&&this.xDataTransform.dataToPlot,l=this.yDataTransform&&this.yDataTransform.dataToPlot,c&&(n.min=c(n.min),n.max=c(n.max)),l&&(t.min=l(t.min),t.max=l(t.max)),v={x:n.min,y:t.min,width:n.max-n.min,height:t.max-t.min})}return v},this.getLocalPadding=function(){var n=0;return{left:n,right:n,top:n,bottom:n}},this.arrange=function(n){D3.CanvasPlot.prototype.arrange.call(this,n);var t=n.width,i=n.height;this.host.css("clip","rect(0px,"+t+"px,"+i+"px,0px)")},this.renderCore=function(n,t){var a,l,r,f,e,it,rt,o,ut,ft;if(D3.DOMPlot.prototype.renderCore.call(this,n,t),a=i.length,a>0){var et=t.height,ot=t.width,d=this.coordinateTransform.plotToScreenX,g=this.coordinateTransform.plotToScreenY,nt=this.xDataTransform&&this.xDataTransform.dataToPlot,tt=this.yDataTransform&&this.yDataTransform.dataToPlot,v=nt?function(n){return d(nt(n))}:d,y=tt?function(n){return g(tt(n))}:g;for(l=0;l<a;l++){r=i[l],r._scale=="none"?(e={x:r.width(),y:r.height()},f={x:v(r._x),y:y(r._y)},it=f.x-r._originX*e.x,rt=f.y-r._originY*e.y,f={x:it,y:rt}):(o=u(r),f={x:v(o.left),y:y(o.top)},e={x:v(o.left+r._width)-f.x,y:y(o.top-r._height)-f.y});var st=0,ht=0,ct=e.y,lt=e.x,s,p=0,w=et,b=f.y,k=f.y+e.y,h=Math.max(p,b),c=Math.min(w,k);s=h<c,s&&(st=h-f.y,ct=c-f.y,p=0,w=ot,b=f.x,k=f.x+e.x,h=Math.max(p,b),c=Math.min(w,k),s=h<c,s&&(ht=h-f.x,lt=c-f.x,r.css("left",f.x+"px"),r.css("top",f.y+"px"),r.css("display","block"),r._scale==="content"?(ut=e.x/r.width(),ft=e.y/r.height(),r.css(D3.CssPrefix+"-transform-origin","0% 0%"),r.css(D3.CssPrefix+"-transform","scale("+ut+","+ft+")")):r._scale==="element"&&(r.css("width",e.x+"px"),r.css("height",e.y+"px")))),s||r.css("display","none")}}},this.onIsRenderedChanged=function(){var t,n,r;if(this.isRendered)for(t=i.length,n=0;n<t;n++)r=i[n],r.css("z-index",D3.ZIndexDOMMarkers);else for(t=i.length,n=0;n<t;n++)r=i[n],r.css("display","none")},this.clear=function(){for(var r=i.length,t,n=0;n<r;n++)t=i[n],t.remove();i=[],this.invalidateLocalBounds(),this.requestUpdateLayout()},this.add=function(n,t,i,u,f,e,o,s){var h=$(n).appendTo(this.host);return r(h,t,i,u,f,e,o,s),this.invalidateLocalBounds(),this.requestUpdateLayout(),h.get(0)},f=function(n){var t=jQuery.grep(i,function(t){return t[0]===n});return t&&t.length>0?t[0]:undefined},this.remove=function(n){var t=function(n){var t=f(n[0]);t&&i.splice(i.indexOf(t),1),n.remove()};typeof n.remove=="function"?t(n):t($(n)),this.invalidateLocalBounds(),this.requestUpdateLayout()},this.set=function(n,t,i,r,u){var e=f(n);if(!e)throw"Element is not found in the plot";e._x=t,e._y=i,e.scale!="none"&&(r&&r>0&&(e._width=r),u&&u>0&&(e._height=u)),this.invalidateLocalBounds(),this.requestUpdateLayout()},Object.defineProperty(this,"domElements",{get:function(){return i.slice(0)},configurable:!1})},D3.DOMPlot.prototype=new D3.Plot,D3.GridlinesPlot=function(n,t){this.base=D3.CanvasPlot,this.base(n,t);var i,r,f="1px",u="LightGray",e={};D3.Utils.readStyle(this.host,e),e&&(u=typeof e.stroke!="undefined"?e.stroke:u,f=typeof e.thickness!="undefined"?e.thickness:f),Object.defineProperty(this,"xAxis",{get:function(){return i},set:function(n){n!=i&&(i=n,this.requestUpdateLayout())},configurable:!1}),Object.defineProperty(this,"yAxis",{get:function(){return r},set:function(n){n!=r&&(r=n,this.requestUpdateLayout())},configurable:!1}),Object.defineProperty(this,"thickness",{get:function(){return f},set:function(n){if(n!=f){if(n<=0)throw"GridLines thickness must be positive";f=n,this.requestNextFrameOrUpdate()}},configurable:!1}),Object.defineProperty(this,"stroke",{get:function(){return u},set:function(n){n!=u&&(u=n,this.requestNextFrameOrUpdate())},configurable:!1}),this.renderCore=function(n,t){var s,h,c,v,o,a,e,l;for(D3.GridlinesPlot.prototype.renderCore.call(this,n,t),i||(s=this.host.attr("data-d3-xaxis"),s&&(h=this.master.get(s),h&&(i=h))),r||(s=this.host.attr("data-d3-yaxis"),s&&(h=this.master.get(s),h&&(r=h))),c=this.getContext(!0),c.strokeStyle=u,c.fillStyle=u,c.lineWidth=1,v=parseInt(f.slice(0,-2)),o=[],i&&(o=i.ticks),e=0,l=o.length;e<l;e++)o[e].invisible||(a=i.getCoordinateFromTick(o[e].position),c.fillRect(a,0,v,t.height));for(o=[],r&&(o=r.ticks),e=0,l=o.length;e<l;e++)o[e].invisible||(a=t.height-1-r.getCoordinateFromTick(o[e].position),c.fillRect(0,a,t.width,v))}},D3.GridlinesPlot.prototype=new D3.CanvasPlot}(),D3.readTable=function(n){var f={},t,i,s,e,o,h,c,r,l,u;if(D3.Utils.readStyle(n,f),t=n.children("table:first-child"),t&&t.length>0&&(t.toggle(),i=t.children("tbody").children("tr"),i&&i.length>0&&(s=i.first(),e=[],s.children("th").each(function(n){var t=$(this).text();e[n]=t,f[t]=[]}),o=i.toArray(),o)))for(h=o.length,c=e.length,r=1;r<h;r++)for(l=$(o[r]).children("td").toArray(),u=0;u<c;u++)f[e[u]][r-1]=parseFloat($(l[u]).text());return f},D3.Utils.getAndClearTextContent=function(n){var t=n.contents().filter(function(){return this.nodeType!=3?!1:!this.data||this.data.trim()==""?!1:!0})[0],i;if(t&&t.data)return i=t.wholeText,typeof t.replaceWholeText!="undefined"?t.replaceWholeText(""):t.data="",i},D3.readCsv=function(n){var e={},r,u,i,f,o,t;if(D3.Utils.readStyle(n,e),r=D3.Utils.getAndClearTextContent(n),r){r=r.trim();var h=function(n){return n.split(/\s+/g)},s=r.split(/\n/g),c=s.length-1;if(c>0){for(u=h(s[0]),i=u[0]?0:1,t=i;t<u.length;t++)e[u[t-i]]=[];for(f=0;f<c;f++)for(o=h(s[f+1]),i=o[0]?0:1,t=i;t<o.length;t++)e[u[t-i]][f]=parseFloat(o[t])}}return e},D3.readCsv2d=function(n){var u={},f,s,i,r,c,t;if(D3.Utils.readStyle(n,u),f=D3.Utils.getAndClearTextContent(n),f){f=f.trim();var l=function(n){return n.trim().split(/\s+/g)},o=f.split(/\n/g),e=o.length-1;if(e>0&&(s=l(o[0]),i=s.length-1,i>0)){var a=new Array(i),v=new Array(e),h=new Array(i);for(t=1;t<=i;t++)h[t-1]=new Array(e),a[t-1]=parseFloat(s[t]);for(r=1;r<=e;r++)for(c=l(o[r]),v[r-1]=parseFloat(c[0]),t=1;t<=i;t++)h[t-1][r-1]=parseFloat(c[t]);u.x=a,u.y=v,u.f=h}}return u},D3.InitializeAxis=function(n,t){if(n.hasClass("d3-axis"))throw"The div element already is initialized as an axis";var i=n.attr("data-d3-axis");switch(i){case"numeric":return new D3.NumericAxis(n);case"log":return new D3.LogarithmicAxis(n);case"labels":return new D3.LabelledAxis(n,t)}},D3.TicksRenderer=function(n,t){var h,a,d,g,r,et,ot,p,k,tt,it;if(typeof Modernizr!="undefined"&&n&&(Modernizr.canvas||n.replaceWith('<div">Browser does not support HTML5 canvas<\/div>')),!n||!n.hasClass("d3-axis")){var v=this,e=n,o="";n&&(o=n.attr("data-d3-placement")),o!="top"&&o!="bottom"&&o!="left"&&o!="right"&&o=="bottom",h=o=="top"||o=="bottom",this.rotateLabels=!1;var w={min:0,max:1},l=t,u=[],rt=3,c=$("<canvas id='canvas' style='position:relative; float:left'><\/canvas>"),y=$("<div id='labelsDiv' style='position:relative; float:left'><\/div>");n&&(o=="bottom"||o=="right"?(n[0].appendChild(c[0]),n[0].appendChild(y[0])):(n[0].appendChild(y[0]),n[0].appendChild(c[0])),a=D3.tickLength+1,h?c[0].height=a:(c[0].width=a,o=="right"?y.css("left",rt):c.css("left",rt))),this.updateSize=function(){var t=r;n&&(d=n.outerWidth(!0),g=n.outerHeight(!0)),h?(r=d,r!=t&&(c[0].width=r,y.css("width",r))):(r=g,r!=t&&(c[0].height=r,y.css("height",r))),et=(r-1)/(w.max-w.min),ot=c[0].height};var s=-1,b=D3.tickLength/3,nt=e?e.css("color"):"Black",f=c.get(0).getContext("2d");f.strokeStyle=nt,f.fillStyle=nt,f.lineWidth=1,p=12,e&&(e.currentStyle?(p=e.currentStyle["font-size"],f.font=p+e.currentStyle["font-family"]):document.defaultView&&document.defaultView.getComputedStyle?(p=document.defaultView.getComputedStyle(e[0],null).getPropertyValue("font-size"),f.font=p+document.defaultView.getComputedStyle(e[0],null).getPropertyValue("font-family")):e.style&&(p=e.style["font-size"],f.font=p+e.style["font-family"])),Object.defineProperty(this,"host",{get:function(){return e},configurable:!1}),Object.defineProperty(this,"mode",{get:function(){return o},configurable:!1}),Object.defineProperty(this,"tickSource",{get:function(){return l},configurable:!1}),Object.defineProperty(this,"range",{get:function(){return w},configurable:!1}),Object.defineProperty(this,"ticks",{get:function(){return u},configurable:!1}),Object.defineProperty(this,"DesiredSize",{get:function(){return{width:d,height:g}},configurable:!1}),Object.defineProperty(this,"axisSize",{get:function(){return r},configurable:!1}),Object.defineProperty(this,"deltaRange",{get:function(){return et},configurable:!1}),this.sizeChanged=!0,k=undefined,Object.defineProperty(this,"dataTransform",{get:function(){return k},set:function(n){k=n,tt()},configurable:!1});var i=[],ut=function(n){var s=n.length,o,u,e,c,t,r;for(i=new Array(s),c=h?ot:0,t=0;t<s;t++)r=n[t],r.label?(o=r.label._size,u=o.width,e=o.height,u==0&&(u=f.measureText(r.position).width*1.5),e==0&&(e=(h?c:parseFloat(p))+8),i[t]={position:v.getCoordinateFromTick(r.position),width:u,height:e,hasLabel:!0}):i[t]={position:v.getCoordinateFromTick(r.position),width:0,height:0,hasLabel:!1}},ft=function(n){var o,f,e=n.length-1,u,t,s;if(it(n),ut(n),e==-1)return 1;for(u=0,t=0;t<e;){for(u=t,t++;t<e+1&&!i[t].hasLabel;)t++;if(t>e)break;if(i[u].hasLabel&&((o=Math.abs(i[t].position-i[u].position),o<D3.minTickSpace)||(h?(f=(i[u].width+i[t].width)/2,u==0&&i[u].position-i[u].width/2<0?f-=i[u].width/2:t==e-1&&i[t].position-i[t].width/2>r&&(f-=i[t].width/2)):(f=(i[u].height+i[t].height)/2,u==0&&i[u].position-i[u].height/2<0?f-=i[u].height/2:t==e-1&&i[t].position-i[t].height/2>r&&(f-=i[t].height/2)),o-f<D3.minLabelSpace)))return-1}for(s=1,u=t=0;t<e;){for(u=t,t++;t<e+1&&!i[t].hasLabel;)t++;if(t>e)break;if(i[u].hasLabel&&(o=Math.abs(i[t].position-i[u].position),h?(f=(i[u].width+i[t].width)/2,u==0&&i[u].position-i[u].width/2<0?f-=i[u].width/2:t==e-1&&i[t].position-i[t].width/2>r&&(f-=i[t].width/2)):(f=(i[u].height+i[t].height)/2,u==0&&i[u].position-i[u].height/2<0?f-=i[u].height/2:t==e-1&&i[t].position-i[t].height/2>r&&(f-=i[t].height/2)),o-f<D3.minLabelSpace)){s=0;break}}return s};this.getCoordinateFromTick||(this.getCoordinateFromTick=function(n){return n}),tt=function(){var vt,yt,pt,et,st,ct,lt,bt,kt,wt,t,p,ot,at,ht,n,tt;if(v.updateSize(),k?(vt=k.plotToData(w.min),yt=k.plotToData(w.max),u=l.getTicks({min:Math.min(vt,yt),max:Math.max(vt,yt)})):u=l.getTicks(w),pt=ft(u),ct=0,pt==-1)while(ct++<D3.maxTickArrangeIterations)if(et=l.decreaseTickCount(),st=ft(et),u=et,st!=-1)break;if(pt==1)while(ct++<D3.maxTickArrangeIterations){if(et=l.increaseTickCount(),st=ft(et),st==-1){u=l.decreaseTickCount(),ut(u),it(u);break}if(u=et,st==0)break}if(lt=!1,l.getMinTicks&&(st==-1&&ct>D3.maxTickArrangeIterations||u.length<2)&&(et=l.getMinTicks(),et.length>0&&(u=et,it(u),ut(u),u.length==2&&(bt=i[1].position-i[0].position,kt=h?(i[0].width+i[1].width)/2:(i[0].height+i[1].height)/2,bt-kt<D3.minLabelSpace&&(lt=!0)))),tt=u.length,wt=s,s=0,this.sizeChanged=!1,h){for(n=0;n<tt;n++)s=Math.max(s,i[n].height);s!=wt&&s!=0&&(y.css("height",s),c[0].height=a,g=s+a,e.css("height",g),this.sizeChanged=!0)}else{for(n=0;n<tt;n++)s=Math.max(s,i[n].width);s!=wt&&s!=0&&(y.css("width",s),c[0].width=a,d=s+a+rt,e.css("width",d),this.sizeChanged=!0)}for(f.strokeStyle=nt,f.fillStyle=nt,h?(f.clearRect(0,0,r,a),o=="bottom"?f.fillRect(0,0,r,1):f.fillRect(0,D3.tickLength,r,1)):(f.clearRect(0,0,a,r),o=="right"?f.fillRect(0,0,1,r):f.fillRect(D3.tickLength,0,1,r)),n=0;n<tt;n++)t=i[n].position,h?(p=i[n].width/2,lt?n==0?p*=2:n==tt-1&&(p=0):n==0&&t<p?p=0:n==tt-1&&t+p>r&&(p*=2),u[n].invisible||f.fillRect(t,1,1,D3.tickLength),u[n].label&&u[n].label.css("left",t-p)):(t=r-1-t,p=i[n].height/2,lt?n==0?p=0:n==tt-1&&(p*=2):n==0&&t+p>r?p*=2:n==tt-1&&t<p&&(p=0),u[n].invisible||f.fillRect(1,t,D3.tickLength,1),u[n].label&&(u[n].label.css("top",t-p),o=="left"&&u[n].label.css("left",s-(this.rotateLabels?i[n].height:i[n].width))));if(ot=l.getSmallTicks(u),ot.length>0){for(at=Math.abs(v.getCoordinateFromTick(ot[1])-v.getCoordinateFromTick(ot[0])),ht=1;ht<ot.length-1;ht++)at=Math.min(at,Math.abs(v.getCoordinateFromTick(ot[ht+1])-v.getCoordinateFromTick(ot[ht])));if(at>=D3.minTickSpace)for(n=0,tt=ot.length;n<tt;n++)t=v.getCoordinateFromTick(ot[n]),o=="bottom"?f.fillRect(t,1,1,b):o=="top"?f.fillRect(t,D3.tickLength-b,1,b):o=="left"?f.fillRect(D3.tickLength-b,r-1-t,b,1):o=="right"&&f.fillRect(1,r-1-t,b,1)}},it=function(n){for(var t,r,i=0,u=n.length;i<u;i++)t=n[i].label,t&&!t.hasClass("d3-axis-label")&&(r=t[0],y[0].appendChild(r),t.addClass("d3-axis-label"),t._size={width:r.offsetWidth,height:r.offsetHeight})},this.update=function(n){w=n,tt()},this.destroy=function(){e[0].innerHTML="",e.removeClass("d3-axis"),e.removeClass("unselectable")},this.remove=function(){var t=e[0].parentElement,n;t&&(t.removeChild(e[0]),n=t.parentElement,n&&(n.className=="d3-plot-master"||n.classList&&n.classList.contains("d3-plot-master"))&&n.plot.removeDiv(t)),this.destroy()},n&&(tt(),n.addClass("d3-axis"),n.addClass("unselectable"))}},D3.NumericAxis=function(n){this.base=D3.TicksRenderer,this.getCoordinateFromTick=function(n){var r=this.deltaRange,t,i;return isFinite(r)?(t=n,i=this.dataTransform,i&&(t=i.dataToPlot(n)),(t-this.range.min)*r):this.axisSize/2},this.base(n,new D3.NumericTickSource)},D3.NumericAxis.prototype=new D3.TicksRenderer,D3.LogarithmicAxis=function(n){this.base=D3.TicksRenderer;var t=Math.log(10);this.getCoordinateFromTick=function(n){var i=this.deltaRange,r;return isFinite(i)?(r=Math.log(n)/t,(r-this.range.min)*i):this.axisSize/2},this.base(n,new D3.LogarithmicTickSource)},D3.LogarithmicAxis.prototype=new D3.TicksRenderer,D3.LabelledAxis=function(n,t){this.base=D3.TicksRenderer;var i=this;this.getCoordinateFromTick=function(n){var i=this.deltaRange,t;return isFinite(i)?(t=n,this.dataTransform&&(t=this.dataTransform.dataToPlot(n)),(t-this.range.min)*i):this.axisSize/2},t&&t.rotate&&(this.rotateLabels=!0),this.base(n,new D3.LabelledTickSource(t))},D3.LabelledAxis.prototype=new D3.TicksRenderer,D3.TickSource=function(){var r=[],n=[],u=[],i=[],t=0;this.start,this.finish,this.getDiv=function(f){var s=this.getInnerText(f),e=u.indexOf(s),h,o;return e!=-1?(n[e]=!0,i[e].display="block",r[e]):(e=n.indexOf(!1),(e=!1)?(n[e]=!0,i[e].display="block",u[e]=s,h=r[e],h.innerHTML=s,o=h[0],h._size={width:o.offsetWidth,height:o.offsetHeight},h):(o=$("<div>"+s+"<\/div>"),n[t]=!0,r[t]=o,u[t]=s,i[t]=o[0].style,o._size=undefined,t++,o))},this.getInnerText=function(n){return n},this.refreshDivs=function(){for(var r=0;r<t;r++)n[r]?n[r]=!1:i[r].display="none"},this.getTicks=function(n){this.start=n.min,this.finish=n.max},this.decreaseTickCount=function(){},this.increaseTickCount=function(){},this.round=function(n,t){if(t<=0)return-t>15?parseFloat(n.toFixed(15)):parseFloat(n.toFixed(-t));var i=Math.pow(10,t-1);return Math.round(n/i)*i}},D3.NumericTickSource=function(){var n,u,i,t,r;this.base=D3.TickSource,this.base(),n=this,u=1/Math.log(10),this.getInnerText=function(n){return n==0?n:t>=D3.minNumOrder?this.round(n/Math.pow(10,t),-1)+"e+"+t:this.round(n,t)},this.getTicks=function(n){return D3.NumericTickSource.prototype.getTicks.call(this,n),i=1,t=Math.floor(Math.log(this.finish-this.start)*u),r()},r=function(){var u=[],e;if(n.start>n.finish)return u;if(isFinite(t)){var f=i*Math.pow(10,t),o=Math.floor(n.start/f),h=Math.floor(n.finish/f)-o+2,s=0,c=o*f,r;for(e=0;e<h;e++)r=c+e*f,r>=n.start&&r<=n.finish&&(u[s]={position:r,label:n.getDiv(r)},s++)}else u[0]={position:n.start,label:n.getDiv(n.start),invisible:!0};return n.refreshDivs(),u},this.decreaseTickCount=function(){return i==1?i=2:i==2?i=5:i==5&&(i=1,t++),r()},this.increaseTickCount=function(){return i==1?(i=5,t--):i==2?i=1:i==5&&(i=2),r()},this.getSmallTicks=function(n){var u=[],i=0,t,r,e,f,o,s;if(n.length>1){for(t=n[0].position,r=Math.abs(n[1].position-t)/10,t-=r;t>this.start&&i<10;)u[i]=t,i++,t-=r;for(e=n.length,f=0;f<e-1;f++)for(t=n[f].position+r,o=0;o<9;o++)u[i]=t,i++,t+=r;for(t=n[e-1].position+r,s=0;t<this.finish&&s<10;)u[i]=t,i++,t+=r,s++}return u},this.getMinTicks=function(){var o=[],r,f,e,h;if(t=Math.floor(Math.log(this.finish-this.start)*u),isFinite(t))if(r=Math.pow(10,t),f=Math.floor(n.start/r)*r,f<n.start&&(f+=r),e=Math.floor(n.finish/r)*r,e>n.finish&&(e-=r),f!=e)o[0]={position:f,label:n.getDiv(n.round(f,t))},o[1]={position:e,label:n.getDiv(n.round(e,t))};else{t--,i=5,r=i*Math.pow(10,t),f=Math.floor(n.start/r);var l=Math.floor(n.finish/r)-f+2,c=0,a=f*r,s;for(h=0;h<l;h++)s=a+h*r,s>=n.start&&s<=n.finish&&(o[c]={position:s,label:n.getDiv(n.round(s,t))},c++)}else o[0]={position:n.start,label:n.getDiv(n.start),invisible:!0};return this.refreshDivs(),o}},D3.NumericTickSource.prototype=new D3.TickSource,D3.LogarithmicTickSource=function(){var u;this.base=D3.TickSource,this.base();var n=this,t=1,f=10,r,i;this.getInnerText=function(n){return Math.abs(n)<D3.minLogOrder?Math.pow(10,n):"10<sup>"+n+"<\/sup>"},this.getTicks=function(n){return D3.LogarithmicTickSource.prototype.getTicks.call(this,n),r=Math.pow(10,this.start),i=Math.pow(10,this.finish),u()},u=function(){var e=[],s;if(isFinite(Math.pow(10,-n.start))&&isFinite(i))if(r==i)e[0]={position:n.start,label:n.getDiv(n.start),invisible:!0};else{var h=n.start/t|0,l=(n.finish/t|0)-h+3,o=(h-1)*t,u=Math.pow(10,o),c=0;for(s=0;s<l;s++)u>=r&&u<=i&&(e[c]={position:u,label:n.getDiv(o)},c++),o+=t,u*=f}return n.refreshDivs(),e},this.decreaseTickCount=function(){return t*=2,f=Math.pow(10,t),u()},this.increaseTickCount=function(){return t>1&&(t/=2,f=Math.pow(10,t)),u()},this.getSmallTicks=function(u){var h=[],a=isFinite(Math.pow(10,-n.start))&&isFinite(i),o=0,f,e,c,s,l;if(u.length>0&&t==1&&a){for(f=u[0].position,e=f/10,f-=e;f>r&&o<10;)h[o]=f,o++,f-=e;for(c=u.length,s=0;s<c-1;s++)for(f=u[s].position,e=(u[s+1].position-f)/10,f+=e,l=0;l<9;l++)h[o]=f,o++,f+=e;for(f=u[c-1].position,e=f,f+=e;f<i;)h[o]=f,o++,f+=e}return h},this.getMinTicks=function(){var t=[],u=isFinite(Math.pow(10,-n.start))&&isFinite(i);return u?r==i&&(t[0]={position:n.start,label:n.getDiv(n.start),invisible:!0},this.refreshDivs()):(t[0]={position:1,label:n.getDiv(0)},this.refreshDivs()),t}},D3.LogarithmicTickSource.prototype=new D3.TickSource,D3.LabelledTickSource=function(n){var l,r,c;this.base=D3.TickSource,this.base();var i=this,f=[],t=[];if(n&&n.labels){for(l=n.labels.length,r=0;r<l;r++)f[r]=n.labels[r].toString();if(n.ticks)t=n.ticks;else for(r=0;r<l;r++)t[r]=r}var u=1,o,s,e=t.length-f.length,h=n&&n.rotate?n.rotate:!1;this.getTicks=function(n){var f,l;if(D3.LabelledTickSource.prototype.getTicks.call(this,n),u=1,e<=0){var i=0,r=t.length-1,h=this.start|0;if(h>t[i])while(r-i>1)f=Math.round((i+r)/2),t[f]<h?i=f:r=f;if(o=i,i=0,r=t.length-1,h=this.finish|1,h<t[r])while(r-i>1)f=Math.round((i+r)/2),t[f]<h?i=f:r=f;if(s=r,s>o)for(l=(t.length-1)/(s-o);u<l;)u*=2}return c()},c=function(){var b=[],c,l,n,w,a,r,p,v,k,d,y;if(e<=0){for(c=Math.floor((t.length-1)/u),c>t.length-1?c=t.length-1:c<1&&(c=1),l=0,n=i.start|0;t[l]<n;)l+=c;for(l-c>=0&&t[l]>n&&(l-=c),w=s-o+1,a=0,v=0;v<w;v++)n=t[l],n>=i.start&&n<=i.finish&&(y=i.getDiv(f[l]),h&&y.addClass("d3-verticalText"),b[a]={position:n,label:y},a++),l+=c}else{for(r=0;t[r]<i.start;)r++;for(r>0&&r--,p=t.length-1;t[p]>i.finish;)p--;p<t.length-1&&p++;var w=p-r+1,a=0,g=t[r];for(v=0;v<w;v++)n=g,n>=i.start&&n<=i.finish&&(b[a]={position:n},a++),r++,g=t[r],k=1,u>1&&(k/=u),v!=w-1&&(d=(Math.min(g,i.finish)+Math.max(n,i.start))/2,d>=i.start&&d<=i.finish&&(y=i.getDiv(f[r-1]),h&&(y.addClass("d3-verticalText"),y.css("transform","rotate(-90deg) scale("+k+", "+k+")")),b[a]={position:d,label:y,invisible:!0},a++))}return i.refreshDivs(),b},this.decreaseTickCount=function(){return e<=0?u/=2:u++,c()},this.increaseTickCount=function(){return e<=0?u*=2:u--,c()},this.getSmallTicks=function(n){var f=[],u,r,i;if(e<=0)for(u=0,r=0,i=0;i<t.length;i++)n.length>r&&t[i]==n[r].position?r++:(f[u]=t[i],u++);return f},this.getMinTicks=function(){var r=[],n;return e<=0&&f.length>0&&Math.floor((t.length-1)/u)>1&&(n=i.getDiv(f[0]),h&&n.addClass("d3-verticalText"),r[0]={position:t[0],label:n},n=i.getDiv(f[f.length-1]),h&&n.addClass("d3-verticalText"),r[1]={position:t[t.length-1],label:n},i.refreshDivs()),r}},D3.LabelledTickSource.prototype=new D3.TickSource,D3.TicksRenderer.getAxisType=function(n){return n===undefined?"numeric":n.type?n.type=="log10"?"log":"numeric":"numeric"},D3=D3||{},D3.ColorPalette=function(n,t,i){var f,r,u,e=this;if(Object.defineProperty(this,"isNormalized",{get:function(){return f},configurable:!1}),Object.defineProperty(this,"range",{get:function(){return r},configurable:!1}),Object.defineProperty(this,"points",{get:function(){return u},configurable:!1}),f=n,r=f?{min:0,max:1}:{min:t.min,max:t.max},r.min>=r.max)throw"range is incorrect (min >= max)";if(i==undefined)throw"points are undefined";if(i.length<2)throw"Palette should have at least two points";u=i.slice(0),this.getRgba=function(n){var t=e.getHsla(n);return D3.ColorPalette.HSLtoRGB(t)},this.getHsla=function(n){var a=u.length,i,r,o,f,l;if(n<=u[0].x)return u[0].leftColor;if(n>=u[a-1].x)return u[a-1].rightColor;for(i=0,r=a-1;r-i>1;)o=Math.round((i+r)/2),u[o].x<n?i=o:r=o;f=u[i],f.x==n&&(r=i);var v=u[r],s=(n-f.x)/(v.x-f.x),t=f.rightColor,h=v.leftColor,e=t.h,c=h.h;return Math.abs(c-e)>3&&(e<c?e+=6:c+=6),l={h:e+(c-e)*s,s:t.s+(h.s-t.s)*s,l:t.l+(h.l-t.l)*s,a:t.a+(h.a-t.a)*s},l.h>=6&&(l.h-=6),l},this.absolute=function(n,t){for(var e=u.length,s=(t-n)/(r.max-r.min),o=new Array(e),f,i=0;i<e;i++)f=u[i],o[i]={x:s*(f.x-r.min)+n,rightColor:f.rightColor,leftColor:f.leftColor};return new D3.ColorPalette(!1,{min:n,max:t},o)},this.relative=function(){var n,t;if(f)return this;var i=u.length,o=1/(r.max-r.min),e=new Array(i);for(n=0;n<i;n++)t=u[n],e[n]={x:o*(t.x-r.min),rightColor:t.rightColor,leftColor:t.leftColor};return new D3.ColorPalette(!0,{min:0,max:1},e)},this.banded=function(n){var o,s,v,i,h,t,a,y;if(!n)throw"bands is undefined";if(o=!1,typeof n=="number"){if(n<1)throw new"number of bands is less than 1";for(o=!0,s=n-1,v=(r.max-r.min)/n,n=new Array(s),t=0;t<s;t++)n[t]=(t+1)*v+r.min}if(i=n.length+2,h=n.length+1,i<2)throw"number of bands is less than 1";var c=new Array(i),e=this.getHsla(r.min),p=h>1?(r.max-r.min)/(h-1):.5*(r.max-r.min),l,u;for(t=0;t<i-1;t++){if(t==0)l=r.min,u=r.min;else{if(l=t==i-2?r.max:o?r.min+t*p:(n[t-1]+n[t])/2,u>=n[t-1])throw"bands points are incorrect";u=n[t-1]}a=this.getHsla(l),y={x:u,rightColor:a,leftColor:e},c[t]=y,e=a}if(u>=r.max)throw"bands points are incorrect";return c[i-1]={x:r.max,rightColor:e,leftColor:e},new D3.ColorPalette(f,r,c)}},D3.ColorPalette.toArray=function(n,t){var r=new Uint8Array(t<<2),s=n.getRgba,e,o,u,f,i;for(n.isNormalized?(e=1/(t-1),o=0):(o=n.range.min,e=(n.range.max-n.range.min)/(t-1)),f=0,i=0;f<t;f++)u=s(f*e+o),r[i++]=u.r,r[i++]=u.g,r[i++]=u.b,r[i++]=255*u.a;return r},D3.ColorPalette.create=function(){var n=arguments,t,u,e,i,r,f;if(!n||n.length==0)throw"colors is undefined or empty";for(t=n.length,t==1&&(t++,n=[n[0],n[0]]),u=new Array(t),e=1/(t-1),i=0;i<t;i++)r=n[i],f=typeof r.r=="number"?D3.ColorPalette.RGBtoHSL(r):r,u[i]={x:i*e,rightColor:f,leftColor:f};return new D3.ColorPalette(!0,{min:0,max:1},u)},D3.ColorPalette.parse=function(n){var o=!0,c,i=[],t,r,f,e,u,s,l,a,h;if(n==undefined&&(n=""),n=="")return D3.palettes.grayscale;if(t=new D3.Lexer(n),r=-1,t.readNext()){if(i.push({x:0,rightColor:{h:0,s:0,l:0,a:1},leftColor:{h:0,s:0,l:1,a:1}}),t.currentLexeme=="number"){if(i[i.length-1].x=t.currentNumber,o=!1,t.readNext()&&(t.currentLexeme!="separator"||t.currentSeparator!="equal"))throw t.position+": separator '=' expected";if(t.readNext()&&t.currentLexeme!="color")throw t.position+": color expected";}if(t.currentLexeme=="color")i[i.length-1].rightColor=t.currentColor,i[i.length-1].leftColor=t.currentColor,i.push({x:i[0].x,rightColor:t.currentColor,leftColor:t.currentColor});else throw t.position+": wrong lexeme";}for(f=i[0].x;t.readNext();)if(t.currentLexeme=="separator"){if(t.currentSeparator=="equal"){if(t.readNext())if(t.currentLexeme=="number"){if(t.currentNumber<f)throw t.position+": number is less than previous";if(f=t.currentNumber,r==-1)i[i.length-1].x=t.currentNumber,r=1;else if(r==0)i[i.length-1].x=t.currentNumber,r=2;else throw t.position+": wrong lexeme";}else if(t.currentLexeme=="color")if(r==1||r==2)i[i.length-1].rightColor=t.currentColor,r=-1;else if(r==0||r==-1)i[i.length-1].x=i[0].x-1,i[i.length-1].rightColor=t.currentColor,r=-1;else throw t.position+": wrong lexeme";else throw t.position+": wrong lexeme";}else if(t.currentSeparator=="comma"&&t.readNext())if(r==1||r==-1||r==2)if(t.currentLexeme=="number"){if(t.currentNumber<=f)throw t.position+": number is less than previous";if(f=t.currentNumber,t.readNext()&&t.currentLexeme=="separator"&&t.currentSeparator=="equal")if(t.readNext()&&t.currentLexeme=="color")r!=-1?i.push({x:t.currentNumber,rightColor:t.currentColor,leftColor:t.currentColor}):(i[i.length-1].x=t.currentNumber,i[i.length-1].rightColor=t.currentColor,i[i.length-1].leftColor=t.currentColor),r=-1;else throw t.position+": color expected";else throw t.position+": wrong lexeme";}else if(t.currentLexeme=="color")r==-1&&i.pop(),r=0;else throw t.position+": wrong lexeme";else if(r==0)if(t.currentLexeme=="number"){if(t.currentNumber<=f)throw t.position+": number is less than previous";if(f=t.currentNumber,i[i.length-1].x=i[0].x-1,t.readNext()&&t.currentLexeme=="separator"&&t.currentSeparator=="equal")if(t.readNext()&&t.currentLexeme=="color")i.push({x:t.currentNumber,rightColor:t.currentColor,leftColor:t.currentColor}),r=-1;else throw t.position+": color expected";else throw t.position+": wrong lexeme";}else if(t.currentLexeme=="color")i[i.length-1].x=i[0].x-1,r=0;else throw t.position+": wrong lexeme";r==-1?i.push({x:i[0].x,rightColor:t.currentColor,leftColor:t.currentColor}):r==0&&i.push({x:i[0].x,rightColor:t.currentColor,leftColor:t.currentColor})}else throw t.position+": separator expected";if(t.currentLexeme=="separator")throw t.position+": wrong lexeme";if(t.currentLexeme=="number"&&o||t.currentLexeme=="color"&&!o)throw t.position+": wrong ending";if(o&&(i[i.length-1].x=1,i[i.length-1].x<i[i.length-2].x))throw t.position+": number is less than previous";if(i[i.length-1].rightColor=i[i.length-1].leftColor,i[0].x>=i[i.length-1].x)throw t.position+": wrong range of palette";for(c={min:i[0].x,max:i[i.length-1].x},e=1,u=0,s=1,l=i.length;s<l;s++)if(i[s].x==i[0].x-1)u==0&&(e=s),u++;else if(u!=0){for(a=(i[e+u].x-i[e-1].x)/(u+1),h=0;h<u;h++)i[e+h].x=i[e-1].x+a*(h+1);u=0,e=1}return new D3.ColorPalette(o,c,i)},D3.Lexer=function(n){if(typeof n!="string")throw"wrong definition of palette: must be a string";var f,e,r,u,i=n,t=0;Object.defineProperty(this,"position",{get:function(){return t},configurable:!1}),Object.defineProperty(this,"paletteString",{get:function(){return i},configurable:!1}),Object.defineProperty(this,"currentSeparator",{get:function(){return u},configurable:!1}),Object.defineProperty(this,"currentLexeme",{get:function(){return r},configurable:!1}),Object.defineProperty(this,"currentNumber",{get:function(){return e},configurable:!1}),Object.defineProperty(this,"currentColor",{get:function(){return f},configurable:!1}),this.readNext=function(){var s,n,o,h;if(t>=i.length)return!1;while(i[t]===" ")t++;if(i[t]==="#"||/^[a-z]/.test(i[t].toLowerCase())){for(r="color",n=t;t<i.length&&i[t]!=" "&&i[t]!="="&&i[t]!=",";)t++;s=i.substring(n,t),f=D3.ColorPalette.RGBtoHSL(D3.ColorPalette.colorFromString(s))}else if(i[t]==="="||i[t]===",")r="separator",u=i[t]=="="?"equal":"comma",t++;else{for(r="number",n=t;t<i.length&&i[t]!=" "&&i[t]!="="&&i[t]!=",";)t++;if(o=i.substring(n,t),h=o.replace(/[^0-9+-Ee.]/g,""),o!=h)throw"wrong number value";e=parseFloat(i.substring(n,t))}return!0}},D3.ColorPalette.colorFromString=function(n){var f={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"#00000000",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},t,i,r,u,e;if(typeof n!="string")throw"wrong definition of color: must be a string";if(f[n.toLowerCase()]&&(e=f[n.toLowerCase()],n=e),n.charAt(0)=="#")if(n.length==7)u=1,t=parseInt(n.substring(1,3),16),i=parseInt(n.substring(3,5),16),r=parseInt(n.substring(5,7),16);else if(n.length==9)t=parseInt(n.substring(1,3),16),i=parseInt(n.substring(3,5),16),r=parseInt(n.substring(5,7),16),u=parseInt(n.substring(7,9),16)/255;else throw"wrong definition of hex color";else throw"wrong definition of hex color";if(isNaN(t)||isNaN(i)||isNaN(r)||isNaN(u))throw"wrong definition of hex color";return{r:t,g:i,b:r,a:u}},D3.ColorPalette.RGBtoHSL=function(n){var f,s,o,h,i;h=n.a;var e=n.r/255,r=n.g/255,u=n.b/255,t=Math.max(e,r);return t=Math.max(t,u),i=Math.min(e,r),i=Math.min(i,u),o=(t+i)/2,s=t==i?0:o<.5?(t-i)/(t+i):(t-i)/(2-t-i),t==i?f=0:t==e?f=r>=u?(r-u)/(t-i):(r-u)/(t-i)+6:t==r?f=2+(u-e)/(t-i):t==u&&(f=4+(e-r)/(t-i)),{h:f,s:s,l:o,a:h}},D3.ColorPalette.HSLtoRGB=function(n){var i,r,u,h,s,t;h=n.a;var e=n.h,l=n.s,c=n.l,f=(1-Math.abs(2*c-1))*l,o=f*(1-Math.abs(e%2-1));return e<2?(u=0,e<1?(i=Math.round(f*255),r=Math.round(o*255)):(i=Math.round(o*255),r=Math.round(f*255))):e<4?(i=0,e<3?(r=Math.round(f*255),u=Math.round(o*255)):(r=Math.round(o*255),u=Math.round(f*255))):e<6&&(r=0,e<5?(i=Math.round(o*255),u=Math.round(f*255)):(i=Math.round(f*255),u=Math.round(o*255))),s=(c-f/2)*255,t=i+s,i=t>255?255:t<0?0:Math.round(t),t=r+s,r=t>255?255:t<0?0:Math.round(t),t=u+s,u=t>255?255:t<0?0:Math.round(t),{r:i,g:r,b:u,a:h}},D3.ColorPaletteViewer=function(n,t){var o=n,u=o.width(),c=20,l=$("<canvas height='"+c+"px'width='"+u+"px'><\/canvas>"),a=$("<div data-d3-placement='bottom' style='margin-top: -5px; width: "+u+"px'><\/div>"),i,r,f,s,e,h;o[0].appendChild(l[0]),o[0].appendChild(a[0]),i=t,Object.defineProperty(this,"palette",{get:function(){return i},set:function(n){n&&(i=n,i.isNormalized&&r||f.update({min:i.range.min,max:i.range.max}),s=(i.range.max-i.range.min)/u,h())},configurable:!1}),r=undefined,Object.defineProperty(this,"dataRange",{get:function(){return r},set:function(n){n&&(r=n,(!i||i.isNormalized)&&f.update({min:r.min,max:r.max}))},configurable:!1}),f=new D3.NumericAxis(a),i?(s=(i.range.max-i.range.min)/u,i.isNormalized||f.update({min:i.range.min,max:i.range.max})):r&&f.update({min:r.min,max:r.max}),e=l.get(0).getContext("2d"),h=function(){for(var r=e.createLinearGradient(0,0,u,0),n,f=i.range.min,t=0;t<u;t++)n=i.getRgba(f),r.addColorStop(t/u,"rgba("+n.r+","+n.g+","+n.b+","+n.a+")"),f+=s;e.fillStyle=r,e.fillRect(0,0,u,c)},i&&h()},D3.SizePalette=function(n,t,i){var f,r,u,o=this,e;if(Object.defineProperty(this,"isNormalized",{get:function(){return f},configurable:!1}),Object.defineProperty(this,"range",{get:function(){return r},configurable:!1}),Object.defineProperty(this,"sizeRange",{get:function(){return u},configurable:!1}),f=n,r=f?{min:0,max:1}:{min:i.min,max:i.max},u={min:t.min,max:t.max},r.min>r.max)throw"valueRange is incorrect (min >= max)";e=(u.max-u.min)/(r.max-r.min),this.getSize=function(n){return n<=r.min?u.min:n>=r.max?u.max:e*(n-r.min)+u.min}},D3.SizePaletteViewer=function(n){var e=n,u=e.width(),r=35,o=$("<canvas height='"+r+"px'width='"+u+"px'><\/canvas>"),s=$("<div data-d3-placement='bottom' style='margin-top: -5px; width: "+u+"px'><\/div>"),i,f;e[0].appendChild(o[0]),e[0].appendChild(s[0]),i=undefined,Object.defineProperty(this,"palette",{get:function(){return i},set:function(n){n&&(i=n,i&&!i.isNormalized&&h.update({min:i.range.min,max:i.range.max}),c())},configurable:!1}),f=undefined,Object.defineProperty(this,"dataRange",{get:function(){return f},set:function(n){n&&(f=n,(!i||i.isNormalized)&&h.update({min:f.min,max:f.max}))},configurable:!1});var h=new D3.NumericAxis(s),t=o.get(0).getContext("2d"),c=function(){var n,f,e;t.clearRect(0,0,u,r),t.fillStyle="lightgray",t.strokeStyle="black",n=0,f=r,i&&i.sizeRange&&(n=i.sizeRange.min,f=i.sizeRange.max),e=r*u/f,t.beginPath(),t.moveTo(0,r),n!=0&&t.lineTo(0,r-n),e<u?(t.lineTo(e,0),t.lineTo(u,0)):t.lineTo(u,r-f),t.lineTo(u,r),t.lineTo(0,r),t.closePath(),t.fill(),t.stroke()};c()},D3.palettes={grayscale:new D3.ColorPalette(!0,{min:0,max:1},[{x:0,rightColor:{h:0,s:0,l:0,a:1},leftColor:{h:0,s:0,l:0,a:1}},{x:1,rightColor:{h:0,s:0,l:1,a:1},leftColor:{h:0,s:0,l:1,a:1}}])},D3.Gestures={},D3.Gestures.FullEventList=["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel","gesturestart","gesturechange","gestureend","MSGestureStart","MSGestureChange","MSGestureEnd","MSGestureCancel","MSPointerDown",],D3.Gestures.zoomLevelFactor=1.4,D3.Gestures.getXBrowserMouseOrigin=function(n,t){var r=function(n){for(var t=0,i=0;n;)t+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;return{left:t,top:i}},i=r(n[0]),u=t.pageX-i.left,f=t.pageY-i.top;return{x:u,y:f}},D3.Gestures.PanGesture=function(n,t,i){this.Type="Pan",this.Source=i,this.xOffset=n,this.yOffset=t},D3.Gestures.ZoomGesture=function(n,t,i,r){this.Type="Zoom",this.Source=r,this.xOrigin=n,this.yOrigin=t,this.scaleFactor=i},D3.Gestures.PinGesture=function(n){this.Type="Pin",this.Source=n},D3.Gestures.createPanSubject=function(n){var i=$(document),r=n.onAsObservable("mousedown"),t=n.onAsObservable("mousemove"),u=i.onAsObservable("mouseup"),f=t.skip(1).zip(t,function(n,t){return new D3.Gestures.PanGesture(n.clientX-t.clientX,n.clientY-t.clientY,"Mouse")}),e=u;return r.selectMany(function(){return f.takeUntil(e)})},D3.Gestures.createPinSubject=function(n){var t=n.onAsObservable("mousedown");return t.select(function(){return new D3.Gestures.PinGesture("Mouse")})},D3.Gestures.createZoomSubject=function(n){n.mousewheel(function(t,i){t.preventDefault();var r=jQuery.Event("xbrowserwheel");r.delta=i,r.origin=D3.Gestures.getXBrowserMouseOrigin(n,t),n.trigger(r)});var t=n.onAsObservable("xbrowserwheel"),r=t.zip(t,function(n){return new D3.Gestures.ZoomGesture(n.origin.x,n.origin.y,n.delta>0?1/D3.Gestures.zoomLevelFactor:1*D3.Gestures.zoomLevelFactor,"Mouse")}),i=n.onAsObservable("dblclick"),u=i.zip(i,function(t){var i=D3.Gestures.getXBrowserMouseOrigin(n,t);return new D3.Gestures.ZoomGesture(i.x,i.y,1/D3.Gestures.zoomLevelFactor,"Mouse")});return r},D3.Gestures.createTouchPanSubject=function(n){var t=$(document),r=n.onAsObservable("touchstart"),i=n.onAsObservable("touchmove"),u=t.onAsObservable("touchend"),f=t.onAsObservable("touchcancel");return r.selectMany(function(){return i.takeUntil(u.merge(f)).skip(1).zip(i,function(n,t){return{left:n.originalEvent,right:t.originalEvent}}).where(function(n){return n.left.scale===n.right.scale}).select(function(n){return new D3.Gestures.PanGesture(n.left.pageX-n.right.pageX,n.left.pageY-n.right.pageY,"Touch")})})},D3.Gestures.createTouchPinSubject=function(n){var t=n.onAsObservable("touchstart");return t.select(function(){return new D3.Gestures.PinGesture("Touch")})},D3.Gestures.createTouchZoomSubject=function(n){var t=$(document),r=n.onAsObservable("gesturestart"),i=n.onAsObservable("gesturechange"),u=t.onAsObservable("gestureend"),f=t.onAsObservable("touchcancel");return r.selectMany(function(n){return i.takeUntil(u.merge(f)).skip(1).zip(i,function(n,t){return{left:n.originalEvent,right:t.originalEvent}}).where(function(n){return n.left.scale!==n.right.scale&&n.right.scale!==0}).select(function(t){var i=t.left.scale/t.right.scale;return new D3.Gestures.ZoomGesture(n.originalEvent.layerX,n.originalEvent.layerY,1/i,"Touch")})})},D3.Gestures.createTouchPanSubjectWin8=function(n){var t=n.onAsObservable("MSGestureStart"),i=n.onAsObservable("MSGestureChange"),r=$(document).onAsObservable("MSGestureEnd");return t.selectMany(function(n){var t=i.startWith({originalEvent:{offsetX:n.originalEvent.offsetX,offsetY:n.originalEvent.offsetY}});return t.takeUntil(r).skip(1).zip(t,function(n,t){return{left:n.originalEvent,right:t.originalEvent}}).where(function(n){return n.left.scale===n.right.scale&&n.left.detail!=n.left.MSGESTURE_FLAG_INERTIA&&n.right.detail!=n.right.MSGESTURE_FLAG_INERTIA}).select(function(n){return new D3.Gestures.PanGesture(n.left.offsetX-n.right.offsetX,n.left.offsetY-n.right.offsetY,"Touch")})})},D3.Gestures.createTouchPinSubjectWin8=function(n){var t=n.onAsObservable("MSPointerDown");return t.select(function(){return new D3.Gestures.PinGesture("Touch")})},D3.Gestures.createTouchZoomSubjectWin8=function(n){var t=n.onAsObservable("MSGestureStart"),i=n.onAsObservable("MSGestureChange"),r=n.onAsObservable("MSGestureEnd");return t.selectMany(function(n){return i.takeUntil(r).where(function(n){return n.originalEvent.scale!==1&&n.originalEvent.scale!==0&&n.originalEvent.detail!=n.originalEvent.MSGESTURE_FLAG_INERTIA}).select(function(t){return new D3.Gestures.ZoomGesture(n.originalEvent.offsetX,n.originalEvent.offsetY,1/t.originalEvent.scale,"Touch")})})},D3.Gestures.GesturesPool=function(){var n=[];this.addMSGestureSource=function(t){n.forEach(function(n){n===t}),n.push(t),t.addEventListener("MSPointerDown",function(n){if(t.gesture===undefined){var i=new MSGesture;i.target=t,t.gesture=i}t.gesture.addPointer(n.pointerId)},!1)}},D3.Gestures.GesturesPool=new D3.Gestures.GesturesPool,D3.Gestures.getGesturesStream=function(n){var t,i,r,f,e,o,u;return window.navigator.msPointerEnabled?(f=n[0],D3.Gestures.GesturesPool.addMSGestureSource(f),t=D3.Gestures.createTouchPanSubjectWin8(n),e=D3.Gestures.createTouchZoomSubjectWin8(n),o=D3.Gestures.createZoomSubject(n),i=e.merge(o),r=D3.Gestures.createTouchPinSubjectWin8(n)):(t=D3.Gestures.createPanSubject(n),i=D3.Gestures.createZoomSubject(n),r=D3.Gestures.createPinSubject(n)),u=r.merge(t.merge(i)),"ontouchstart"in document.documentElement&&(t=D3.Gestures.createTouchPanSubject(n),i=D3.Gestures.createTouchZoomSubject(n),r=D3.Gestures.createTouchPinSubject(n),u=u.merge(r.merge(t.merge(i)))),u},D3.Gestures.applyHorizontalBehavior=function(n){return n.select(function(n){return n.Type=="Pan"?n.yOffset=0:n.Type=="Zoom"&&(n.preventVertical=!0),n})},D3.Gestures.applyVerticalBehavior=function(n){return n.select(function(n){return n.Type=="Pan"?n.xOffset=0:n.Type=="Zoom"&&(n.preventHorizontal=!0),n})},D3=typeof D3=="undefined"?{}:D3,D3.DataTransform=function(n,t,i,r){this.dataToPlot=n,this.plotToData=t,this.domain=i||{isInDomain:function(){return!0}},this.type=r},mercator_maxPhi=85.05112878,mercator_R=mercator_maxPhi/Math.log(Math.tan(mercator_maxPhi*Math.PI/360+Math.PI/4)),D3.mercatorTransform=new D3.DataTransform(function(n){return n>=-mercator_maxPhi&&n<=mercator_maxPhi?mercator_R*Math.log(Math.tan(Math.PI*(n+90)/360)):n},function(n){return-mercator_maxPhi<=n&&n<=mercator_maxPhi?360*Math.atan(Math.exp(n/mercator_R))/Math.PI-90:n},undefined,"mercator"),Math.LOGE10=Math.log(10),D3.logTransform=new D3.DataTransform(function(n){return Math.log(n)/Math.LOGE10},function(n){return Math.pow(10,n)},{isInDomain:function(n){return n>0}},"log10"),D3.AnimationBase=function(){var n=undefined,t=this,i;this.isInAnimation=!1,i=Rx.Observable.create(function(t){return n=t,function(){}}),Object.defineProperty(this,"currentObserver",{get:function(){return n},configurable:!1}),Object.defineProperty(this,"currentObservable",{get:function(){return i},configurable:!1}),this.targetPlotRect=undefined,this.getCurrentPlotRect=function(){},this.stop=function(){if(t.isInAnimation&&(t.isInAnimation=!1),n){n.onNext({plotRect:t.getCurrentPlotRect(),isLast:!0});n.onCompleted(),n=undefined}this.additionalStopRutines()},this.additionalStopRutines=function(){},this.animate=function(){}},D3.PanZoomAnimation=function(){var v,a;this.base=D3.AnimationBase,this.base();var f=this,y=undefined,i=undefined,r=undefined,h=new Date,n=undefined,c=undefined,t=undefined,e=0,u=undefined,l=undefined,o=0,s=0;this.getCurrentPlotRect=function(){return n},Object.defineProperty(this,"previousEstimatedPlotRect",{get:function(){return c},configurable:!1}),v=function(){var v=f.currentObserver;if(v){var y=new Date,g=y.getTime()-h.getTime(),a=l*g,u=r.x-n.x,c=r.y-n.y,p=Math.max(r.width/1e3,Math.sqrt(u*u+c*c)),w=n.x+p*a*t.x,b=n.y+p*a*t.y,k=(r.width-n.width)*a+n.width,d=(r.height-n.height)*a+n.height;h=y,u=w-i.x,c=b-i.y;var nt=Math.sqrt(u*u+c*c),tt=k-i.width,it=d-i.height;if(nt>=e||Math.abs(tt)>Math.abs(o)||Math.abs(it)>Math.abs(s))f.isInAnimation=!1,n=r,f.stop();else{n={x:w,y:b,width:k,height:d},f.currentPlotRect=n;v.onNext({plotRect:n,isLast:!1})}}},a=function(){v(),f.isInAnimation&&(u=setTimeout(function(){a()},1e3/60))},this.animate=function(h,v){D3.Gestures.zoomLevelFactor!=1.2&&(D3.Gestures.zoomLevelFactor=1.2),u!==undefined&&(clearTimeout(u),u=undefined),c=v;var y=h();i=n===undefined?y.plotRect:n,r=v,n=i,t={x:r.x-i.x,y:r.y-i.y},e=Math.sqrt(t.x*t.x+t.y*t.y),t=e>1e-10?{x:t.x/e,y:t.y/e}:{x:0,y:0},o=v.width-i.width,s=v.height-i.height,l=o!=0||s!=0?.008:.009,f.isInAnimation=!0,a()},this.additionalStopRutines=function(){u!==undefined&&(clearTimeout(u),u=undefined),f.isInAnimation=!1,y=undefined,i=undefined,startCS=undefined,r=undefined,h=new Date,n=undefined,c=undefined,t=undefined,e=0,startScreenCenter=undefined,previousFrameScreenCenter=undefined,endScreenCenter=undefined,u=undefined,o=0,s=0}},D3.PanZoomAnimation.prototype=new D3.AnimationBase,D3.Utils.getPlotRectForMap=function(n,t){var e=85.05112878,y=t===undefined?{width:n.getWidth(),height:n.getHeight()}:t,r=n.getCenter(),it=y.width,p=y.height,l=30,o=n.tryLocationToPixel({latitude:0,longitude:r.longitude},Microsoft.Maps.PixelReference.control),rt=n.tryLocationToPixel({latitude:0,longitude:r.longitude+l},Microsoft.Maps.PixelReference.control),a=rt.x-o.x,k,f,d,c;a<0&&(a=o.x-n.tryLocationToPixel({latitude:0,longitude:r.longitude-l},Microsoft.Maps.PixelReference.control).x);var w=a/l,b=r.longitude-o.x/w,ut=r.longitude+(it-o.x)/w,v=n.getBounds(),s=v.getNorth(),u=v.getSouth(),h=0;s>=e&&(s=e,k=n.tryLocationToPixel({latitude:s,longitude:r.longitude},Microsoft.Maps.PixelReference.control),h=k.y),f=0,u<=-e&&(u=-e,d=n.tryLocationToPixel({latitude:u,longitude:r.longitude},Microsoft.Maps.PixelReference.control),f=p-d.y),c=ut-b,c<0&&(c=v.width);var i={y:u,x:b,width:c,height:s-u},g=D3.mercatorTransform.dataToPlot(i.y),ft=D3.mercatorTransform.dataToPlot(i.y+i.height);if(i.y=g,i.height=ft-g,f!=0||h!=0){var et=p-h-f,nt=i.height/et,ot=f*nt,st=h*nt,tt=i.y-ot,ht=i.y+i.height+st;i.y=tt,i.height=ht-tt}return i},D3.BingMapsAnimation=function(n){var l;this.base=D3.AnimationBase,this.base();var r=this,t=n,o=undefined,f=undefined,a=new Date,i=undefined,h=undefined,u=undefined,s=0,e=undefined,y=undefined,k=0,d=0,c=!1;Object.defineProperty(this,"previousEstimatedPlotRect",{get:function(){return h},configurable:!1});var it=function(n){var t=D3.mercatorTransform.dataToPlot(n.y),i=D3.mercatorTransform.dataToPlot(n.y+n.height);return{x:n.x,y:t,width:n.width,height:i-t}},g=function(){var b=r.currentObserver,w;if(b){var h=new Date,k=h.getTime()-a.getTime(),e=y*k,n=f.x-i.x,t=f.y-i.y,c=Math.max(f.width/1e3,Math.sqrt(n*n+t*t)),l=i.x+c*e*u.x,p=i.y+c*e*u.y,d=(f.width-i.width)*e+i.width,g=(f.height-i.height)*e+i.height;a=h,n=l-o.x,t=p-o.y,w=Math.sqrt(n*n+t*t),w>=s?(r.isInAnimation=!1,v(f),r.stop()):(i={x:l,y:p,width:d,height:g},r.currentPlotRect=i,v(i))}},p=function(){g(),r.isInAnimation&&(e=setTimeout(function(){p()},1e3/60))};this.animate=function(n,t,a){if(D3.Gestures.zoomLevelFactor!=1.4&&(D3.Gestures.zoomLevelFactor=1.4),e!==undefined&&(clearTimeout(e),e=undefined),h=t,r.isInAnimation=!0,a.isFirstFrame&&l(!0),a.gestureType=="Pan"){c=!1;var w=n();o=i===undefined?w.plotRect:i,f=t,i=o,u={x:f.x-o.x,y:f.y-o.y},s=Math.sqrt(u.x*u.x+u.y*u.y),u=s>1e-10?{x:u.x/s,y:u.y/s}:{x:0,y:0},y=.008,p()}else c=!0,v(t)};var rt=function(){var n=t.getCenter(),f={width:t.getWidth(),height:t.getHeight()},o=f.width,l=f.height,r=30,i=t.tryLocationToPixel({latitude:0,longitude:n.longitude},Microsoft.Maps.PixelReference.control),s=t.tryLocationToPixel({latitude:0,longitude:n.longitude+r},Microsoft.Maps.PixelReference.control),u=s.x-i.x;u<0&&(u=i.x-t.tryLocationToPixel({latitude:0,longitude:n.longitude-r},Microsoft.Maps.PixelReference.control).x);var e=u/r,h=n.longitude-i.x/e,c=n.longitude+(o-i.x)/e;return c-h},w=function(n,t,i){var r=Math.max(1,Math.log(t.width/n.width*360/256)/Math.log(2)),f=D3.mercatorTransform.plotToData(n.y),e=D3.mercatorTransform.plotToData(n.y+n.height),u=Math.max(1,Math.log(t.height/(e-f)*180/256)/Math.log(2));return i===!0&&(r=Math.round(r)-1,u=Math.round(u)),Math.min(r,u)},nt=function(n,t){return{width:t.width*360/(256*Math.pow(2,n)),height:t.height*180/(256*Math.pow(2,n))}};this.setMapView=function(n,i){var r=i;i===undefined&&(r={width:t.getWidth(),height:t.getHeight()});var f=w(n,r,!0),e=t.getZoom(),u={x:n.x+n.width/2,y:D3.mercatorTransform.plotToData(n.y+n.height/2)};t.setView({center:new Microsoft.Maps.Location(u.y,u.x),zoom:f,animate:!1})};var b=0,v=function(n){var i,e=t.getZoom()+b,u;if(b=0,i=c?w(n,{width:t.getWidth(),height:t.getHeight()}):e,u={x:n.x+n.width/2,y:D3.mercatorTransform.plotToData(n.y+n.height/2)},c)if(e>1||i>e){var y=Math.round(i),o=nt(y,{width:t.getWidth(),height:t.getHeight()}),f={x:n.zoomOrigin.x,y:D3.mercatorTransform.plotToData(n.zoomOrigin.y)},s={x:f.x-u.x,y:f.y-u.y},a={x:o.width/n.width,y:o.height/n.height},v={x:f.x-s.x*a.x,y:f.y-s.y*a.y};t.setView({center:new Microsoft.Maps.Location(v.y,v.x),zoom:i,animate:!0})}else l(),h=r.getCurrentPlotRect(),r.stop();else t.setView({center:new Microsoft.Maps.Location(u.y,u.x),zoom:i,animate:!1})},tt=function(){return D3.Utils.getPlotRectForMap(t)};this.getCurrentPlotRect=function(){return tt(t.getBounds(),t.getCenter())},l=function(n){var i=r.currentObserver,u,t;if(i!==undefined){u=r.getCurrentPlotRect(),t={plotRect:u,isLast:!1},n!==undefined&&(t.syncUpdate=n);i.onNext(t)}},Microsoft.Maps.Events.addHandler(t,"viewchange",function(){l()}),Microsoft.Maps.Events.addHandler(t,"viewchangeend",function(){h=r.getCurrentPlotRect(),c||!r.isInAnimation?r.stop():l()}),this.additionalStopRutines=function(){e!==undefined&&(clearTimeout(e),e=undefined),r.isInAnimation=!1,o=undefined,f=undefined,h=undefined,a=new Date,i=undefined,u=undefined,s=0,e=undefined,k=0,d=0}},D3.BingMapsAnimation.prototype=new D3.AnimationBase,D3.Navigation=function(n,t){var r=n,i=this,o=t,u=undefined,s=undefined,e=undefined,f=undefined,l;Object.defineProperty(this,"animation",{get:function(){return e},set:function(n){i.stop(),e=n},configurable:!1});var a=D3.NavigationUtils.calcPannedRect,v=D3.NavigationUtils.calcZoomedRect,h=function(){var n=r.screenSize,t=r.coordinateTransform,i=t.getPlotRect({x:0,y:0,width:n.width,height:n.height});return{plotRect:i,screenSize:n,cs:t}},c=function(){if(e)return e.currentObservable.subscribe(function(n){n.isLast&&(r.isInAnimation=!1),o(n.plotRect,{syncUpdate:n.syncUpdate})},function(){},function(){})};this.setVisibleRect=function(n,t,u){if(i.stop(),f=n,t)i.animation.isInAnimation||c(),r.isInAnimation=!0,i.animation.animate(h,n);else{var e=n;i.animation&&i.animation.constraint&&(e=i.animation.constraint(e)),o(e,u)}},l=function(n){var e=r.screenSize,s,u,l=i.animation!==undefined?i.animation.previousEstimatedPlotRect:f,t,y;if(l!==undefined?(s=D3.Utils.calcCSWithPadding(l,{width:e.width,height:e.height},{left:0,top:0,bottom:0,right:0},r.aspectRatio),u=l):(s=r.coordinateTransform,u=s.getPlotRect({x:0,y:0,width:e.width,height:e.height})),n.Type=="Pin"){i.animation&&i.animation.isInAnimation&&i.stop();return}t=undefined,n.Type=="Pan"?(t=a(u,e,n),f=t):n.Type=="Zoom"&&(t=v(u,s,n),t.width<1e-9&&(t.width=u.width,t.x=u.x),t.height<1e-9&&(t.height=u.height,t.y=u.y),f=t),t&&(i.animation?(y=!i.animation.isInAnimation,y&&c(),r.isInAnimation=!0,i.animation.animate(h,t,{gestureType:n.Type,isFirstFrame:y})):o(t))},this.stop=function(){r.isInAnimation=!1,f=undefined,i.animation&&i.animation.stop()},Object.defineProperty(this,"gestureSource",{get:function(){return u},set:function(n){u!=n&&(s&&s.Dispose(),u=n,u!==undefined&&(s=u.subscribe(function(n){l(n)})))},configurable:!1}),i.animation=new D3.PanZoomAnimation},D3.NavigationUtils={},D3.NavigationUtils.SuppressDefaultMultitouch=function(){if(navigator.userAgent.match(/(iPhone|iPod|iPad)/)&&document.addEventListener("touchmove",function(n){n.preventDefault()}),navigator.userAgent.indexOf("Mac")!=-1){var n=document.getElementsByTagName("body")[0];n.style.overflow="hidden"}},D3.NavigationUtils.calcPannedRect=function(n,t,i){var r={x:n.width/t.width,y:n.height/t.height},u=i.xOffset*r.x,f=-i.yOffset*r.y;return{x:n.x-u,y:n.y-f,width:n.width,height:n.height}},D3.NavigationUtils.calcZoomedRect=function(n,t,i){var r=t.getScale(),h=t.plotToScreenX(n.x+n.width/2),c=t.plotToScreenY(n.y+n.height/2),f=i.preventHorizontal?0:i.xOrigin-h,e=i.preventVertical?0:i.yOrigin-c,u={x:n.x+f/r.x,y:n.y-e/r.y,width:n.width,height:n.height},o=n.width*(i.preventHorizontal?1:i.scaleFactor),s=n.height*(i.preventVertical?1:i.scaleFactor),l=u.x+u.width/2-o/2,a=u.y+u.height/2-s/2;return{x:l-i.scaleFactor*f/r.x,y:a+i.scaleFactor*e/r.y,width:o,height:s,zoomOrigin:{x:t.screenToPlotX(i.xOrigin),y:t.screenToPlotY(i.yOrigin)}}},D3.SharedRenderWorker=function(n,t){var r=!!window.Worker;!r&&window.console&&console.log("Web workers are not available");var u=r?new Worker(n):null,f=!1,i=[],s=this,e=function(n,t){for(var f=i.length,u,r=0;r<f;r++)if(i[r].source==n)return i[r];return t?undefined:(u={source:n,pendingTask:undefined,index:f},i.push(u),u)},o=function(n){var u=i.length,r=0,t;if(n){for(r=n.index,t=r+1;t<u;t++)if(i[t].pendingTask)return i[t];for(t=0;t<r;t++)if(i[t].pendingTask)return i[t]}else for(t=0;t<u;t++)if(i[t].pendingTask)return i[t];return undefined};r&&(u.onmessage=function(n){var e=n.data,s=i[e.sourceIndex],r=o(s);r?(f=!0,u.postMessage(r.pendingTask),r.pendingTask=undefined):f=!1,t&&t(s.source,e)},u.onerror=function(n){var t=n.message+" ("+n.filename+":"+n.lineno+")";typeof console=="object"&&console.log(t)}),this.enqueue=function(n,t){var i=e(t);n.sourceIndex=i.index,f?i.pendingTask=n:(f=!0,i.pendingTask=undefined,u.postMessage(n))},this.cancelPending=function(n){var t=e(n,!0);t&&(t.pendingTask=undefined)},r||(this.enqueue=function(){},this.cancelPending=function(){})},D3.Figure=function(n,t){var o,a,e,l,w;if(t!==undefined)throw"Figure cannot be a dependent plot";if(n){n&&(o=$("<div data-d3-plot='plot' data-d3-placement='center'><\/div>"),o.css("z-index",D3.ZIndexNavigationLayer).css("background-color","rgba(0,0,0,0)")),a=n.children().toArray(),o.appendTo(n),this.base=D3.Plot,this.base(n,t,o),e=this,o.dblclick(function(){e.master.fitToView()});var v=function(n){var t=n.css("position");return t=="static"?n.css("position","relative"):t=="inherit"&&n.css("position","relative"),(t===undefined||t=="")&&n.css("position","relative"),n.css("position")=="relative"},i=[],r=[],s=[],u=[],f=[],y=function(n,t){var h=$("<div><\/div>"),o,c;h.appendTo(e.host).addClass("d3-figure-container"),h.content=n,n.appendTo(h),o=n.attr("data-d3-placement"),n.attr("data-d3-axis")&&(c=D3.InitializeAxis(n,t),n.axis=c,n.dblclick(function(){o=="bottom"||o=="top"?e.master.fitToViewX():e.master.fitToViewY()})),o=="left"?i.push(h):o=="bottom"?r.push(h):o=="center"?s.push(h):o=="right"?f.push(h):o=="top"&&u.push(h),o&&h.attr("data-d3-placement",o)};this.getAxes=function(n){var o,t,e;if(n){if(n=="top"?t=jQuery.grep(u,function(t){if(t.content&&t.content.axis&&t.content.axis.mode==n)return t.content.axis}):n=="bottom"?t=jQuery.grep(r,function(t){if(t.content&&t.content.axis&&t.content.axis.mode==n)return t.content.axis}):n=="left"?t=jQuery.grep(i,function(t){if(t.content&&t.content.axis&&t.content.axis.mode==n)return t.content.axis}):n=="right"&&(t=jQuery.grep(f,function(t){if(t.content&&t.content.axis&&t.content.axis.mode==n)return t.content.axis})),t&&t.length>0){for(e=0;e<t.length;e++)t[e]=t[e].content.axis;return t}}else if(o=i.concat(r).concat(f).concat(u),t=jQuery.grep(o,function(n){if(n.content&&n.content.axis)return n.content.axis}),t&&t.length>0){for(e=0;e<t.length;e++)t[e]=t[e].content.axis;return t}return undefined},this.get=function(n){var r=D3.Figure.prototype.get.call(this,n),t,i;if(!r){if(t=this.getAxes(),t)for(i=0;i<t.length;i++)if(t[i].host[0].id==n||t[i].host[0]==n)return t[i];return undefined}return r},a.forEach(function(n){var t=$(n);v(t)&&y(t)}),l=function(n,t,i,r){var u=$(n);if(!u.is("div"))throw"Only DIVs can be added to figure!";if(t!==undefined){if(t!="top"&&t!="bottom"&&t!="center"&&t!="left"&&t!="right")throw"Placement is incorrect!";u.attr("data-d3-placement",t)}return v(u)&&u.attr("data-d3-placement")!==undefined?y(u,i):u.appendTo(e.host),r!==undefined&&r||e.requestUpdateLayout(),u},this.addDiv=function(n,t){return l(n,t)[0]};var h=function(n){var t=[],i=[];return n.forEach(function(n){n.children().toArray().length==0?t.push(n):i.push(n)}),t.forEach(function(n){n.remove()}),i},p=function(n,t){var i=jQuery.grep(t,function(t){return t==n});return i&&i.length>0},c=function(n,t){var i=jQuery.grep(t,function(t){return t.content[0]==n});return i&&i.length>0};this.removeDiv=function(n){var o,t;if(n===undefined)throw"Unable to remove undefined object!";if(o=this.host.children().toArray(),!p(n,o)&&!c(n,i)&&!c(n,r)&&!c(n,s)&&!c(n,f)&&!c(n,u))throw"Specified div doesn't belong to figure!";t=$(n),t.remove(),t.attr("data-d3-placement")&&(t.attr("data-d3-placement")=="left"?i=h(i):t.attr("data-d3-placement")=="bottom"?r=h(r):t.attr("data-d3-placement")=="center"?s=h(s):t.attr("data-d3-placement")=="right"?f=h(f):t.attr("data-d3-placement")=="top"&&(u=h(u))),e.requestUpdateLayout()},this.addAxis=function(n,t,i){var r=t===undefined?"numeric":t;return l('<div data-d3-axis="'+r+'"><\/div>',n,i,!1)},this.measure=function(n){var o=this.fit(n),y,ot,h,c,a,v,l;w={x:0,y:0,width:n.width,height:n.height};var d=function(n,t,i,r,u,f){for(var o=0,a=n.length,e,s,l,c,h=0;h<a;h++)e=n[h],s=e.content,e.width(t),f&&e.css("top",r(o)),e.css("left",u),s.axis!==undefined?(s.width(t),l=s.axis,l.update(i),c=s.height(),e.height()!==c&&e.height(c),o+=e.height()):o+=e.height(),f||e.css("top",r(o));return o},g=function(n,t,i,r,u,f){for(var o=0,a=n.length,e,s,l,c,h=0;h<a;h++)e=n[h],s=e.content,e.height(t),f&&e.css("left",r(o)),e.css("top",u),s.axis!==undefined?(s.height(t),l=s.axis,l.update(i),c=s.width(),e.width()!==c&&e.width(c),o+=e.width()):o+=e.width(),f||e.css("left",r(o));return o},k=0,p=0,nt=0;p=d(u,n.width,{min:o.x,max:o.x+o.width},function(n){return n},0,!0),nt=d(r,n.width,{min:o.x,max:o.x+o.width},function(t){return n.height-t},0,!1),k=p+nt;var et=0,b=0,tt=0;b=g(i,n.height-k,{min:o.y,max:o.y+o.height},function(n){return n},p,!0),tt=g(f,n.height-k,{min:o.y,max:o.y+o.height},function(t){return n.width-t},p,!1),et=b+tt,y={width:n.width-et,height:n.height-k},e.mapControl!==undefined&&e.mapControl.setOptions({width:y.width,height:y.height}),o=this.fit(y,!0),s.forEach(function(n){n.width(y.width),n.height(y.height),n.css("top",p),n.css("left",b)}),ot=this.children,ot.forEach(function(n){var t=n.host;t.width(y.width),t.height(y.height),t.css("top",p),t.css("left",b)});var ut=0,ft=0;if(ut=d(u,y.width,{min:o.x,max:o.x+o.width},function(n){return n},b,!0),ft=d(r,y.width,{min:o.x,max:o.x+o.width},function(t){return n.height-t},b,!1),ut!=p)for(a=p/ut,v=0,l=0;l<u.length;l++)t=u[l],h="scaleY("+a+") translate(0px,"+v+"px)",c="0% 0%",t.css("-webkit-transform",h),t.css("-webkit-transform-origin",c),t.css("-moz-transform",h),t.css("-moz-transform-origin",c),t.css("-o-transform",h),t.css("-o-transform-origin",c),t.css("-ms-transform",h),t.css("-ms-transform-origin",c),t.css("transform",h),t.css("transform-origin",c),v+=t.height()*(a-1);else u.forEach(function(n){n.css("-ms-transform",""),n.css("-webkit-transform",""),n.css("-moz-transform",""),n.css("-o-transform",""),n.css("transform","")});if(nt!=ft)for(a=nt/ft,v=0,l=0;l<r.length;l++)t=r[l],h="scaleY("+a+") translate(0px,"+-v+"px)",c="0% 0%",t.css("-webkit-transform",h),t.css("-webkit-transform-origin",c),t.css("-moz-transform",h),t.css("-moz-transform-origin",c),t.css("-o-transform",h),t.css("-o-transform-origin",c),t.css("-ms-transform",h),t.css("-ms-transform-origin",c),t.css("transform",h),t.css("transform-origin",c),v+=t.height()*(a-1);else r.forEach(function(n){n.css("-ms-transform",""),n.css("-webkit-transform",""),n.css("-moz-transform",""),n.css("-o-transform",""),n.css("transform","")});var st=0,it=0,rt=0;if(it=g(i,n.height-k,{min:o.y,max:o.y+o.height},function(n){return n},p,!0),rt=g(f,n.height-k,{min:o.y,max:o.y+o.height},function(t){return n.width-t},p,!1),st=it+rt,b!=it)for(a=b/it,v=0,l=0;l<i.length;l++){var t=i[l],h="scaleX("+a+") translate("+v+"px, 0px)",c="0% 0%";t.css("-webkit-transform",h),t.css("-webkit-transform-origin",c),t.css("-moz-transform",h),t.css("-moz-transform-origin",c),t.css("-o-transform",h),t.css("-o-transform-origin",c),t.css("-ms-transform",h),t.css("-ms-transform-origin",c),t.css("transform",h),t.css("transform-origin",c),v+=t.width()*(a-1)}else i.forEach(function(n){n.css("-ms-transform",""),n.css("-webkit-transform",""),n.css("-moz-transform",""),n.css("-o-transform",""),n.css("transform","")});if(tt!=rt)for(a=tt/rt,v=0,l=0;l<f.length;l++){var t=f[l],h="scaleX("+a+") translate("+-v+"px, 0px)",c="100% 0%";t.css("-webkit-transform",h),t.css("-webkit-transform-origin",c),t.css("-moz-transform",h),t.css("-moz-transform-origin",c),t.css("-o-transform",h),t.css("-o-transform-origin",c),t.css("-ms-transform",h),t.css("-ms-transform-origin",c),t.css("transform",h),t.css("transform-origin",c),v+=t.width()*(a-1)}else f.forEach(function(n){n.css("-ms-transform",""),n.css("-webkit-transform",""),n.css("-moz-transform",""),n.css("-o-transform",""),n.css("transform","")});return y},this.arrange=function(n){D3.Figure.prototype.arrange.call(this,n)},this.requestUpdateLayout()}},D3.Figure.prototype=new D3.Plot,D3.Chart=function(n,t){var c,s,e,h,o;if(n){if(t!==undefined)throw"Chart cannot be a dependent plot";c=$("<div data-d3-plot='grid' data-d3-placement='center'><\/div>").prependTo(n),this.base=D3.Figure,this.base(n,t);var i=this,r=i.addAxis("left","numeric"),u=i.addAxis("bottom","numeric"),f=this.get(c[0]);f.xAxis=this.get(u[0]),f.yAxis=this.get(r[0]),s=$("<div><\/div>").prependTo(this.centralPart),e=new D3.Legend(this,s),s.css("float","right"),Object.defineProperty(this,"legend",{get:function(){return e},configurable:!1}),h={},D3.Utils.readStyle(n,h),o=h.isLegendVisible,o&&(o=="true"?e.isVisible=!0:o=="false"&&(e.isVisible=!1)),this.onDataTranformChangedCore=function(n){var t;n=="y"?(t=D3.TicksRenderer.getAxisType(i.yDataTransform),r.axis.host.attr("data-d3-axis")==t?t!="log"&&(r.axis.dataTransform=i.yDataTransform):(i.removeDiv(r[0]),r.axis.destroy(),r=i.addAxis("left",t,!0),f.yAxis=this.get(r[0])),i.enumAll(i,function(n){n!=i&&(n.yDataTransform=i.yDataTransform)})):n=="x"&&(t=D3.TicksRenderer.getAxisType(i.xDataTransform),u.axis.host.attr("data-d3-axis")==t?t!="log"&&(u.axis.dataTransform=i.xDataTransform):(i.removeDiv(u[0]),u.axis.destroy(),u=i.addAxis("bottom",t,!0),f.xAxis=this.get(u[0])),i.enumAll(i,function(n){n!=i&&(n.xDataTransform=i.xDataTransform)}))},this.onChildrenChanged=function(n){n.type=="add"&&(i.xDataTransform&&(n.plot.xDataTransform=i.xDataTransform),i.yDataTransform&&(n.plot.yDataTransform=i.yDataTransform))};var l=D3.Gestures.getGesturesStream(i.centralPart),a=D3.Gestures.applyHorizontalBehavior(D3.Gestures.getGesturesStream(u)),v=D3.Gestures.applyVerticalBehavior(D3.Gestures.getGesturesStream(r));i.navigation.gestureSource=l.merge(a.merge(v))}},D3.Chart.prototype=new D3.Figure,D3.CustomMarkerShape=function(n,t,i){this.draw=n,this.getBoundingBox=t,this.getLegendItem=i},D3.Markers=function(n,t){var tt=D3.Utils.getDataSourceFunction(n,D3.readCsv),o=tt(n),nt,g,w;if(this.base=D3.CanvasPlot,this.base(n,t),n){var a,l,f="#4169ed",s,v,c,r="box",i=10,h,u,k=!1,y=undefined,b=!1,e=undefined,p=this,d=$("<div><\/div>");d.width(10),d.height(10),nt=$("<canvas><\/canvas>").appendTo(d),g=nt[0].getContext("2d"),g.fillStyle="rgba(100,100,100,0.3)",g.fillRect(0,0,10,10),o&&(f=typeof o.color!="undefined"?o.color:f,c=typeof o.border!="undefined"?o.border:c,u=typeof o.sizePalette!="undefined"?o.sizePalette:undefined,r=typeof o.shape!="undefined"?o.shape:r,i=typeof o.size!="undefined"?o.size:i,u=typeof o.sizePalette!="undefined"?o.sizePalette:undefined),this.draw=function(data){var y2=data.y,n,defaultSize,prop;if(!y2)throw"Data series y is undefined";if(n=y2.length,data.x||(data.x=D3.Utils.range(0,n-1)),n!=data.x.length)throw"Data series x and y have different lengths";a=y2,l=data.x,f=typeof data.color!="undefined"?data.color:f,typeof i!="string"&&(s=typeof data.colorPalette!="undefined"?data.colorPalette:undefined,s&&s.isNormalized&&(v=D3.Utils.getMinMax(f))),c=typeof data.border!="undefined"?data.border:c,r=typeof data.shape!="undefined"?data.shape:r,typeof r=="string"&&(w(r)||(r=eval(r))),defaultSize=typeof i=="number"?i:10,i=typeof data.size!="undefined"?data.size:defaultSize,typeof i!="number"&&(u=typeof data.sizePalette!="undefined"?data.sizePalette:undefined,u&&u.isNormalized&&(h=D3.Utils.getMinMax(i))),e={};for(prop in data)prop!="x"&&prop!="y"&&prop!="size"&&prop!="color"&&prop!="shape"&&(e[prop]={value:data[prop],isArray:data[prop]instanceof Array});k=!0,this.invalidateLocalBounds(),this.requestNextFrameOrUpdate(),this.fireAppearanceChanged()},this.computeLocalBounds=function(){var n=this.xDataTransform&&this.xDataTransform.dataToPlot,t=this.yDataTransform&&this.yDataTransform.dataToPlot;return D3.Utils.getBoundingBoxForArrays(l,a,n,t)},this.getLocalPadding=function(){var n=0;return r&&typeof r.getPadding=="function"?r.getPadding(e):(n=typeof i=="number"?i/2:u?u.sizeRange.max/2:D3.Utils.getMinMax(i).max/2,{left:n,right:n,top:n,bottom:n})},w=function(n){if(typeof n=="string"){var t=n.toLowerCase();return t=="box"?1:t=="circle"?2:t=="diamond"?3:t=="cross"?4:t=="triangle"?5:!1}return!1},this.renderCore=function(n,o){var ct,it,yt,st,ti,ht,wt,lt,ii,ft,et,ot,g,at,rt;if((D3.Markers.prototype.renderCore.call(this,n,o),l!==undefined&&a!=undefined)&&(ct=a.length,ct!=0)){var vt=this.getTransform(),ri=vt.dataToScreenX,ui=vt.dataToScreenY,bt=o.width,kt=o.height,ei=bt,oi=kt,fi=!p.master.isInAnimation||!(p.master.mapControl!==undefined);if(p.mapControl!==undefined){if(k||y===undefined){if(y!==undefined&&(y.forEach(function(n){var t=p.mapControl.entities.indexOf(n);t>=0&&p.mapControl.entities.removeAt(t)}),y=undefined),p.mapControl!==undefined)for(y=[],it=0;it<ct;it++)yt=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(a[it],l[it]),{visible:!1,htmlContent:'<div style="background-color: white; opacity: 0.5; width: 10px; height: 10px"><\/div>',anchor:new Microsoft.Maps.Point(5,5)}),y.push(yt),t.mapControl.entities.push(yt);k=!1}p.master.isInAnimation===!0&&y!==undefined?b===!1&&(y.forEach(function(n){n.setOptions({visible:!0})}),b=!0):b===!0&&(y.forEach(function(n){n.setOptions({visible:!1})}),b=!1)}if(fi){var d=this.getContext(!0),pt=f instanceof Array,dt=i instanceof Array;pt||(d.strokeStyle=f,d.fillStyle=f),st=!1,c&&(st=!0,d.strokeStyle=c);var nt,it=0,ut=f,gt=s&&s.isNormalized,tt=i,ni=u&&u.isNormalized;if(typeof r=="object"){for(ti=r.draw;it<ct;it++)if(et=l[it],ot=a[it],et==et&&ot==ot){if(dt){if(tt=i[it],tt!=tt)continue;u&&(ni&&(tt=(tt-h.min)/(h.max-h.min)),tt=u.getSize(tt))}if(pt){if(ut=f[it],ut!=ut)continue;s&&(gt&&(ut=(ut-v.min)/(v.max-v.min)),ft=s.getRgba(ut),ut="rgba("+ft.r+","+ft.g+","+ft.b+","+ft.a+")")}ht={x:et,y:ot};for(wt in e)lt=e[wt],ht[wt]=lt.isArray?lt.value[it]:lt.value;tt&&(ht.size=tt),ut&&(ht.color=ut),c&&(ht.border=c),ti(ht,n,o,vt,d)}}else for(ii=w(r);it<ct;it++)if(et=l[it],ot=a[it],et==et&&ot==ot){if(nt=ri(et),y1=ui(ot),dt){if(tt=i[it],tt!=tt)continue;u&&(ni&&(tt=(tt-h.min)/(h.max-h.min)),tt=u.getSize(tt))}if(g=tt/2,!(nt-g>bt)&&!(nt+g<0)&&!(y1-g>kt)&&!(y1+g<0)){if(pt){if(ut=f[it],ut!=ut)continue;s&&(gt&&(ut=(ut-v.min)/(v.max-v.min)),ft=s.getRgba(ut),ut="rgba("+ft.r+","+ft.g+","+ft.b+","+ft.a+")"),d.fillStyle=ut}switch(ii){case 1:d.fillRect(nt-g,y1-g,tt,tt),st&&d.strokeRect(nt-g,y1-g,tt,tt);break;case 2:d.beginPath(),d.arc(nt,y1,g,0,2*Math.PI),d.fill(),st&&d.stroke();break;case 3:d.beginPath(),d.moveTo(nt-g,y1),d.lineTo(nt,y1-g),d.lineTo(nt+g,y1),d.lineTo(nt,y1+g),d.closePath(),d.fill(),st&&d.stroke();break;case 4:at=tt/3,rt=at/2,st?(d.beginPath(),d.moveTo(nt-g,y1-rt),d.lineTo(nt-rt,y1-rt),d.lineTo(nt-rt,y1-g),d.lineTo(nt+rt,y1-g),d.lineTo(nt+rt,y1-rt),d.lineTo(nt+g,y1-rt),d.lineTo(nt+g,y1+rt),d.lineTo(nt+rt,y1+rt),d.lineTo(nt+rt,y1+g),d.lineTo(nt-rt,y1+g),d.lineTo(nt-rt,y1+rt),d.lineTo(nt-g,y1+rt),d.closePath(),d.fill(),d.stroke()):(d.fillRect(nt-rt,y1-g,at,tt),d.fillRect(nt-g,y1-rt,tt,at));break;case 5:d.beginPath(),d.moveTo(nt-g,y1+g),d.lineTo(nt,y1-g),d.lineTo(nt+g,y1+g),d.closePath(),d.fill(),st&&d.stroke()}}}}}},this.getTooltip=function(n,t){var ut,et,ht,ct,v,rt,lt,g,nt,s,o,y,at,d;if(l!=undefined&&a!=undefined&&(ut=l.length,et=a.length,ut!=0&&et!=0)){var ft=i instanceof Array,ot=f instanceof Array,c,v=0,p=i,st=u&&u.isNormalized,it=this.getTransform(),b=it.dataToScreenX(n),k=it.dataToScreenY(t),vt=this,tt=function(n){var i="<b>"+vt.name+"<\/b>",t;for(t in n)n.hasOwnProperty(t)&&(i+="<br/><b>"+t+"<\/b>: "+n[t]);return"<div>"+i+"<\/div>"};if(typeof r=="object"){if(typeof r.hitTest=="function")for(ht={x:b,y:k},ct={x:n,y:t},v=0;v<ut;v++){var g=l[v],nt=a[v],o={};for(y in e)o[y]=e[y].isArray?e[y].value[v]:e[y].value;if(ft&&(p=i[v],u&&(st&&(p=(p-h.min)/(h.max-h.min)),p=u.getSize(p))),o.x=g,o.y=nt,r.hitTest(o,it,ht,ct)){o={};for(y in e)e[y].isArray&&(o[y]=e[y].value[v]);return ft&&(o.size=i[v]),ot&&(o.color=f[v]),o.x=g,o.y=nt,tt(o)}}}else for(rt=function(n,t){for(var u=function(n,t,i){var r={x:i.x-t.x,y:i.y-t.y},u={x:n.x-t.x,y:n.y-t.y},f=r.x*u.y-r.y*u.x;return f>0?1:f<0?2:0},r=t.length,i=0;i<r;i++)if(u(n,t[i],t[(i+1)%r])!=1)return!1;return!0},lt=w(r);v<ut;v++)if((g=l[v],nt=a[v],g==g&&nt==nt)&&(c=it.dataToScreenX(g),y1=it.dataToScreenY(nt),ft&&(p=i[v],u&&(st&&(p=(p-h.min)/(h.max-h.min)),p=u.getSize(p))),s=p/2,b>=c-s&&b<=c+s&&k>=y1-s&&k<=y1+s)){o={};for(y in e)e[y].isArray&&(o[y]=e[y].value[v]);ft&&(o.size=i[v]),ot&&(o.color=f[v]),o.x=g,o.y=nt;switch(lt){case 1:return tt(o);case 2:if((c-b)*(c-b)+(y1-k)*(y1-k)<=s*s)return tt(o);case 3:if(rt({x:b,y:k},[{x:c-s,y:y1},{x:c,y:y1-s},{x:c+s,y:y1},{x:c,y:y1+s},]))return tt(o);case 4:if(at=p/3,d=at/2,rt({x:b,y:k},[{x:c-d,y:y1+s},{x:c-d,y:y1-s},{x:c+d,y:y1-s},{x:c+d,y:y1+s},])||rt({x:b,y:k},[{x:c-s,y:y1+d},{x:c-s,y:y1-d},{x:c+s,y:y1-d},{x:c+s,y:y1+d},]))return tt(o);break;case 5:if(rt({x:b,y:k},[{x:c-s,y:y1+s},{x:c,y:y1-s},{x:c+s,y:y1+s}]))return tt(o)}}}},this.onDataTransformChanged=function(n){this.invalidateLocalBounds(),D3.Markers.prototype.onDataTransformChanged.call(this,n)},Object.defineProperty(this,"color",{get:function(){return f},set:function(n){n!=f&&(f=n,this.fireAppearanceChanged("color"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"colorPalette",{get:function(){return s},set:function(n){n!=s&&(s=n,s.isNormalized&&(v=D3.Utils.getMinMax(f)),this.fireAppearanceChanged("colorPalette"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"border",{get:function(){return c},set:function(n){n!=c&&(c=n,this.fireAppearanceChanged("border"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"size",{get:function(){return i},set:function(n){n!=i&&(i=n,this.fireAppearanceChanged("size"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"sizePalette",{get:function(){return u},set:function(n){n!=u&&(u=n,u.isNormalized&&(h=D3.Utils.getMinMax(i)),this.fireAppearanceChanged("sizePalette"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"shape",{get:function(){return r},set:function(n){n!=r&&(r=n,this.fireAppearanceChanged("shape"),this.requestNextFrameOrUpdate())},configurable:!1}),this.getLegend=function(){var b=$("<div class='d3-legend-item'><\/div>"),ot=$("<div><\/div>").appendTo(b),nt=14,ni,ti;document.defaultView&&document.defaultView.getComputedStyle&&(nt=parseFloat(document.defaultView.getComputedStyle(b[0],null).getPropertyValue("font-size"))),(isNaN(nt)||nt==0)&&(nt=14);var rt=$("<canvas style='margin-right: 10px; display: inline-block'><\/canvas>").appendTo(ot),ut=!0,k=nt*1.5,o=k/2+1,a=k/2+1;rt[0].width=rt[0].height=k+2;var pt=rt[0].style,n=rt.get(0).getContext("2d"),ii=$("<span style='vertical-align: top'>"+this.name+"<\/span>").appendTo(ot),tt,wt,ft=0,st,et,it,p,ht,ct,lt,d=0,bt,y,t,at,vt,yt,g=0,kt=function(){bt=i instanceof Array,bt?(y=k,u&&(g==0&&(at=$("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'><\/div>").appendTo(b),vt=at[0].style,yt=new D3.SizePaletteViewer(at),g=2),yt.palette=u,u.isNormalized&&(yt.dataRange=h),g==1&&(vt.display="block",g=2))):(y=Math.min(i,k),g==2&&(vt.display="none",g=1)),t=y/2},dt=function(){st=f instanceof Array,p=!1,st&&s?(d==0&&(ht=$("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'><\/div>").appendTo(b),ct=ht[0].style,lt=new D3.ColorPaletteViewer(ht),d=2),lt.palette=s,s.isNormalized&&(lt.dataRange=v),d==1&&(ct.display="block",d=2)):d==2&&(ct.display="none",d=1),st?(it="#000000",et="#ffffff",p=!0):(et=f,it=f,c&&(p=!0,it=c))},gt=function(){var u,h,f,c,v,s,i;if(typeof r=="object"){if(r.getLegendItem){u={x:l[0],y:l[0]},u.size=y,u.color=et,u.border=it;for(h in e)f=e[h],u[h]=f.isArray?f.value[0]:f.value;ft==0?(tt=r.getLegendItem(u),ot[0].insertBefore(tt[0],ii[0])):(c=r.getLegendItem(u),tt.replaceWith(c),tt=c),wt=tt[0].style,ft=2}ut&&(pt.display="none",ut=!1)}else{ft==2&&(wt.display="none",ft=1),n.clearRect(0,0,k+2,k+2),n.strokeStyle=it,n.fillStyle=et,v=w(r);switch(v){case 1:n.fillRect(o-t,a-t,y,y),p&&n.strokeRect(o-t,a-t,y,y);break;case 2:n.beginPath(),n.arc(o,a,t,0,2*Math.PI),n.fill(),p&&n.stroke();break;case 3:n.beginPath(),n.moveTo(o-t,a),n.lineTo(o,a-t),n.lineTo(o+t,a),n.lineTo(o,a+t),n.closePath(),n.fill(),p&&n.stroke();break;case 4:s=y/3,i=s/2,p?(n.beginPath(),n.moveTo(o-t,a-i),n.lineTo(o-i,a-i),n.lineTo(o-i,a-t),n.lineTo(o+i,a-t),n.lineTo(o+i,a-i),n.lineTo(o+t,a-i),n.lineTo(o+t,a+i),n.lineTo(o+i,a+i),n.lineTo(o+i,a+t),n.lineTo(o-i,a+t),n.lineTo(o-i,a+i),n.lineTo(o-t,a+i),n.closePath(),n.fill(),n.stroke()):(n.fillRect(o-i,a-t,s,y),n.fillRect(o-t,a-i,y,s));break;case 5:n.beginPath(),n.moveTo(o-t,a+t),n.lineTo(o,a-t),n.lineTo(o+t,a+t),n.closePath(),n.fill(),p&&n.stroke()}ut||(pt.display="inline-block",ut=!0)}};return dt(),kt(),gt(),ni=this,this.host.bind("appearanceChanged",function(n,t){t&&t!="color"&&t!="colorPalette"||dt(),t&&t!="size"&&t!="sizePalette"||kt(),gt()}),ti=function(){ni.host.unbind("appearanceChanged"),b[0].innerHTML="",b.removeClass("d3-legend-item")},{div:b,onLegendRemove:ti}},o&&typeof o.y!="undefined"&&this.draw(o)}},D3.Markers.prototype=new D3.CanvasPlot,D3.heatmapBackgroundRenderer=new D3.SharedRenderWorker("script/d3heatmapworker-1.0.1.js",function(n,t){n.onRenderTaskCompleted(t)}),D3.Heatmap=function(n,t){var ot=D3.Utils.getDataSourceFunction(n,D3.readCsv2d),e=ot(n),nt,i,ft,k,tt,h,s,et;if(e&&typeof e.y!="undefined"&&typeof e.f!="undefined"){var p=e.y,it=e.f,rt=p.length,st=it.length;if(rt>1&&st>0&&p[0]>p[1])for(p.reverse(),h=0;h<rt;h++)it[h].reverse()}if(this.base=D3.CanvasPlot,this.base(n,t),n){var d=function(n){if(n)try{r=typeof n=="string"?D3.ColorPalette.parse(n):n,ut=D3.ColorPalette.toArray(r,512)}catch(t){window.console&&console.error("Failed to initialize the palette")}},g=function(n){y=Math.min(1,Math.max(0,n))},c=document.createElement("canvas"),l,u,f,o,a,v,y,w,r,b,ut;if(g(e&&typeof e.opacity!="undefined"?parseFloat(e.opacity):1),d(e&&typeof e.palette!="undefined"?e.palette:D3.palettes.grayscale),nt=function(){var u=o.length,r,t,f,i,n;if(!(u<1)&&(r=o[0].length,!(r<1)))for(a=v=o[0][0],t=0;t<u;t++)for(f=o[t],i=0;i<r;i++)n=f[i],n==n&&(n>v?v=n:n<a&&(a=n))},ft=this,this.onRenderTaskCompleted=function(n){i=n,(c.width!==i.width||c.height!==i.height)&&(c.width=i.width,c.height=i.height);var t=c.getContext("2d");t.putImageData(i.image,0,0),ft.requestNextFrame()},this.draw=function(n){var s=n.f,t,c,l;if(!s)throw"Data series f is undefined";var h=s.length,e=s[0].length,i=n.x;if(i){if(i.length!=h&&i.length!=h+1)throw"Data series x must have length equal or one more than length of data series f by first dimension";}else i=D3.Utils.range(0,h);if(t=n.y,t){if(t.length!=e&&t.length!=e+1)throw"Data series y must have length equal or one more than length of data series f by second dimension";}else t=D3.Utils.range(0,e);if(f=i,u=t,o=s,i.length==h){if(t.length!=e)throw"Data series y must have length equal to length of data series f by second dimension";w="gradient"}else{if(t.length!=e+1)throw"Data series y must have length equal to one more than length of data series f by second dimension";w="matrix"}if(f.length<2)throw"Data series x must have at least 2 elements by each dimension";if(u.length<2)throw"Data series y must have at least 2 elements by each dimension";n&&typeof n.opacity!="undefined"&&g(parseFloat(n.opacity)),n&&typeof n.palette!="undefined"&&d(n.palette),r.isNormalized&&nt(),b=!0,c=this.invalidateLocalBounds(),l=this.getLocalBounds(),D3.Utils.equalRect(c,l)?this.requestNextFrame():this.requestNextFrameOrUpdate(),this.fireAppearanceChanged()},this.computeLocalBounds=function(){var l,t,i,r,e,h,c,n,o,s;if(f&&u){for(h=f.length,c=u.length,n=0;n<h;n++)if(t=f[n],t==t)break;for(n=h;--n>=0;)if(i=f[n],i==i)break;for(n=0;n<c;n++)if(r=u[n],r==r)break;for(n=c;--n>=0;)if(e=u[n],e==e)break;o=this.xDataTransform&&this.xDataTransform.dataToPlot,s=this.yDataTransform&&this.yDataTransform.dataToPlot,o&&(t=o(t),i=o(i)),s&&(r=s(r),e=s(e)),l={x:Math.min(t,i),y:Math.min(r,e),width:Math.abs(i-t),height:Math.abs(e-r)}}return l},typeof Modernizr!="undefined"&&n&&(!Modernizr.webworkers||!Modernizr.postmessage)){if(k=n[0].parentElement,k){for(tt=!1,h=0;h<k.childNodes.length;h++)if($(k.childNodes[h]).hasClass("nowebworkers")){tt=!0;break}n[0].removeAttribute("data-d3-plot"),n[0].innerText="",tt?n[0].innerText="":(n[0].innerText=" Heatmap cannot be rendered: browser does not support web workers.",n.addClass("nowebworkers"))}return}s=undefined,this.renderCore=function(n,e){var w,tt,k,ot,ht,it,rt,ct,lt,at,vt;if(D3.Heatmap.prototype.renderCore.call(this,n,e),w=this.getContext(!0),f!=undefined&&u!=undefined&&o!=undefined){var nt=this.coordinateTransform,ft=nt.plotToScreenX,et=nt.plotToScreenY,h=this.getLocalBounds(),d=D3.Utils.intersect(h,n);if(d&&(tt=!0,t.mapControl!==undefined&&(s!==undefined&&b&&(t.mapControl.entities.remove(s),s==undefined),tt=!t.isInAnimation,t.isInAnimation?(s===undefined&&(k=120,ot={fillColor:new Microsoft.Maps.Color(k,k,k,k),strokeColor:new Microsoft.Maps.Color(k,k,k,k),strokeThickness:1},s=new Microsoft.Maps.Polygon([new Microsoft.Maps.Location(D3.mercatorTransform.plotToData(h.y),h.x),new Microsoft.Maps.Location(D3.mercatorTransform.plotToData(h.y),h.x+h.width),new Microsoft.Maps.Location(D3.mercatorTransform.plotToData(h.y+h.height),h.x+h.width),new Microsoft.Maps.Location(D3.mercatorTransform.plotToData(h.y+h.height),h.x),],ot)),t.mapControl.entities.indexOf(s)===-1&&t.mapControl.entities.push(s)):s!==undefined&&t.mapControl.entities.indexOf(s)!==-1&&t.mapControl.entities.removeAt(t.mapControl.entities.indexOf(s))),tt)){window.console&&console.log("basic");var p={left:Math.floor(ft(d.x)),width:Math.ceil(nt.plotToScreenWidth(d.width)),top:Math.floor(et(d.y+d.height)),height:Math.ceil(nt.plotToScreenHeight(d.height))},g=nt.getScale(),st=nt.getOffset();w.fillStyle="rgba(200,200,200,0.3)",w.fillRect(p.left,p.top,p.width,p.height),i&&(ht=D3.Utils.intersect(i.plotRect,n),ht&&(it=ft(i.plotRect.x),rt=et(i.plotRect.y+i.plotRect.height),y!=1&&(ct=w.globalAlpha,w.globalAlpha=y),g.x!=i.scaleX||g.y!=i.scaleY?(lt=g.x/i.scaleX,at=g.y/i.scaleY,w.drawImage(c,0,0,i.image.width,i.image.height,it,rt,lt*i.image.width,at*i.image.height)):w.drawImage(c,it,rt),y!=1&&(w.globalAlpha=ct))),!b&&(this.master.isInAnimation||i&&i.scaleX==g.x&&i.scaleY==g.y&&D3.Utils.includes(i.plotRect,d))||(l&&l.width===p.width&&l.height===p.height||(l=w.createImageData(p.width,p.height)),vt={image:l,width:l.width,height:l.height,x:f,y:u,f:o,fmin:a,fmax:v,plotRect:d,scaleX:g.x,scaleY:g.y,offsetX:st.x-p.left,offsetY:st.y-p.top,palette:{isNormalized:r.isNormalized,range:r.range,points:r.points,colors:ut},xDataTransform:this.xDataTransform&&this.xDataTransform.type,yDataTransform:this.yDataTransform&&this.yDataTransform.type},D3.heatmapBackgroundRenderer.enqueue(vt,this),b=!1)}}},this.onIsRenderedChanged=function(){this.isRendered||D3.heatmapBackgroundRenderer.cancelPending(this)},this.onDataTransformChanged=function(n){this.invalidateLocalBounds(),D3.Heatmap.prototype.onDataTransformChanged.call(this,n)},et=function(n,t){var e=f.length,o=u.length,i,r;if(e!=0&&o!=0&&!(n<f[0])&&!(t<u[0])&&!(n>f[e-1])&&!(t>u[o-1])){for(i=1;i<e;i++)if(n<=f[i]){if(isNaN(f[i-1]))return NaN;break}for(r=1;r<o;r++)if(t<=u[r]){if(isNaN(u[r-1]))return NaN;break}return i>=e||r>=o?NaN:{iLeft:i-1,jBottom:r-1}}},this.getValue=function(n,t){var p=f.length,b=u.length,i,r,e,c,l,s;if(p==0||b==0||(i=et(n,t),i==undefined))return null;if(i!=i)return"<div>"+(this.name||"heatmap")+": (unknown value)<\/div>";if(w==="gradient")if(c=o[i.iLeft][i.jBottom+1],e=o[i.iLeft][i.jBottom],l=o[i.iLeft+1][i.jBottom+1],s=o[i.iLeft+1][i.jBottom],isNaN(c)||isNaN(e)||isNaN(l)||isNaN(s))r=NaN;else{var h=u[i.jBottom],a=u[i.jBottom+1],k=(c-e)/(a-h),d=(l-s)/(a-h),v=k*(t-h)+e,g=d*(t-h)+s,y=f[i.iLeft],nt=f[i.iLeft+1],tt=(g-v)/(nt-y);r=tt*(n-y)+v}else r=o[i.iLeft][i.jBottom];return r},this.getTooltip=function(n,t){if(o!==undefined){var i=this.getValue(n,t);if(i!=null)return"<div>"+(this.name||"heatmap")+": "+i+"<\/div>"}},Object.defineProperty(this,"palette",{get:function(){return r},set:function(n){if(n!=r){if(!n)throw"Heatmap palette is undefined";r&&n.isNormalized&&!r.isNormalized&&o&&nt(),d(n),i=undefined,this.fireAppearanceChanged("palette"),this.requestNextFrame()}},configurable:!1}),Object.defineProperty(this,"opacity",{get:function(){return y},set:function(n){if(!n)throw"Heatmap opacity is undefined";n!=y&&(g(n),this.fireAppearanceChanged("opacity"),this.requestNextFrame())},configurable:!1}),Object.defineProperty(this,"mode",{get:function(){return w},configurable:!1}),this.getLegend=function(){var n=$("<div class='d3-legend-item'>"+this.name+"<\/div>"),f=$("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'><\/div>").appendTo(n),t=new D3.ColorPaletteViewer(f,r),i,u;return r&&r.isNormalized&&(t.dataRange={min:a,max:v}),i=this,this.host.bind("appearanceChanged",function(n,i){i&&i!="palette"||(t.palette=r);var u=t.dataRange;r&&r.isNormalized&&(u.min!=a||u.max!=v)&&(t.dataRange={min:a,max:v})}),u=function(){i.host.unbind("appearanceChanged"),n[0].innerHTML="",n.removeClass("d3-legend-item")},{div:n,onLegendRemove:u}},e&&typeof e.f!="undefined"&&this.draw(e)}},D3.Heatmap.prototype=new D3.CanvasPlot,D3.register("heatmap",function(n,t){return new D3.Heatmap(n,t)}),D3.BingMaps=D3.BingMaps||{},D3.BingMaps.ESRI=D3.BingMaps.ESRI||{},D3.BingMaps.ESRI.GetWorldTopo=function(){function n(n){return"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/"+n.levelOfDetail+"/"+n.y+"/"+n.x}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMaps.ESRI.GetDeLorme=function(){function n(n){return"http://server.arcgisonline.com/ArcGIS/rest/services/Specialty/DeLorme_World_Base_Map/MapServer/tile/"+n.levelOfDetail+"/"+n.y+"/"+n.x}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMaps.ESRI.GetWorldImagery=function(){function n(n){return"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/"+n.levelOfDetail+"/"+n.y+"/"+n.x}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMaps.ESRI.GetOceanBasemap=function(){function n(n){return"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/"+n.levelOfDetail+"/"+n.y+"/"+n.x}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMaps.ESRI.GetNationalGeographicMap=function(){function n(n){return"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/"+n.levelOfDetail+"/"+n.y+"/"+n.x}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMaps.ESRI.GetWorldShadedRelief=function(){function n(n){return"http://services.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/"+n.levelOfDetail+"/"+n.y+"/"+n.x}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMaps.ESRI.GetWorldTerrainBase=function(){function n(n){return"http://services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/"+n.levelOfDetail+"/"+n.y+"/"+n.x}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMaps.OpenStreetMap=D3.BingMaps.OpenStreet||{},D3.BingMaps.OpenStreetMap.GetTileSource=function(){function n(n){return"http://tile.openstreetmap.org/"+n.levelOfDetail+"/"+n.x+"/"+n.y+".png"}return new Microsoft.Maps.TileSource({uriConstructor:n})},D3.BingMapsPlot=function(n,t){var o,s,i,u;if(n){o=$('<div style="position: absolute"><\/div>').prependTo(n),this.base=D3.Plot,this.base(n,t);var f=this,r=undefined,e=undefined;f.children.length===0&&(r=$('<div style="position: absolute;"><\/div>').appendTo(n),r.css("z-index",D3.ZIndexNavigationLayer),e=$("<canvas><\/canvas>").appendTo(r)),s=85.05112878,this.mapKey=n.attr("data-d3-mapKey"),i=new Microsoft.Maps.Map(o[0],{credentials:f.mapKey,mapTypeId:Microsoft.Maps.MapTypeId.aerial,enableClickableLogo:!1,enableSearchLogo:!1,showCopyright:!1,showDashboard:!1,showLogo:!1,disablePanning:!0,disableZooming:!0,width:n.width(),height:n.height()}),Object.defineProperty(this,"map",{get:function(){return i},configurable:!1}),u=new D3.BingMapsAnimation(i),this.arrange=function(n){D3.BingMapsPlot.prototype.arrange.call(this,n),i.width=n.width,i.height=n.height},this.setMap=function(n){if(i.setMapType(Microsoft.Maps.MapTypeId.mercator),i.entities.clear(),n)if(n instanceof Microsoft.Maps.TileSource){var t=new Microsoft.Maps.TileLayer({mercator:n,opacity:1});i.entities.push(t)}else i.setMapType(n)},this.constraint=function(n,t){var r=i.getWidth(),f=i.getHeight();return r<=1||f<=1?n:(u.setMapView(n,t),mapRect=D3.Utils.getPlotRectForMap(i))},this.arrange=function(n){D3.CanvasPlot.prototype.arrange.call(this,n),r!==undefined&&(r.width(n.width),r.height(n.height),e[0].width=n.width,e[0].height=n.height)},u.constraint=this.constraint,f.navigation.animation=u,this.selfMapRefresh()}},D3.BingMapsPlot.prototype=new D3.Plot;